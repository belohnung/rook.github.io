












































<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />

    
    <meta name="robots" content="noindex">
    

    <title>Ceph Docs</title>

    <link rel="canonical" href="https://rook.io/docs/rook/v0.8/upgrade-patch.html">

    <link rel="icon" href="/favicon.ico" />
<link rel="icon" type="image/png" href="/images/favicon_16x16.png" sizes="16x16" />
<link rel="icon" type="image/png" href="/images/favicon_32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="/images/favicon_48x48.png" sizes="48x48" />
<link rel="icon" type="image/png" href="/images/favicon_192x192.png" sizes="192x192" />


    <link href="//fonts.googleapis.com/css?family=Montserrat:500|Open+Sans:300,400,600" rel="stylesheet">
    
    <link rel="stylesheet" href="/css/main.css">
    
      <link rel="stylesheet" href="/css/docs.css" />
    
  </head>
  <body>
    <nav id="navigation" aria-label="Navigation">
  <div>
    <div class="logo">
      <a href="/"><img src="/images/rook-logo.svg"/></a>
    </div>
    <div
      class="hamburger-controls"
      onclick="if (document.body.classList.contains('menu-open')) { document.body.classList.remove('menu-open') } else { document.body.classList.add('menu-open') }; return false;">
      <span></span> <span></span> <span></span>
    </div>
    <ul class="links">
      <li class="dropdown">
        <a role="button" href="javascript:void(0)">Documentation</a>
        <div class="dropdown-content">
          <a href="/docs/rook/v1.9/">Ceph</a>
          <a href="/docs/cassandra/v1.7/">Cassandra</a>
          <a href="/docs/nfs/v1.7/">NFS</a>
        </div>
      <li class="dropdown">
        <a role="button" href="javascript:void(0)">Community</a>
        <div class="dropdown-content">
          <a href="//github.com/rook/rook">GitHub</a>
          <a href="//slack.rook.io/">Slack</a>
          <a href="//groups.google.com/forum/#!forum/rook-dev">Forum</a>
          <a href="//twitter.com/rook_io">Twitter</a>
        </div>
      </li>
      <li><a href="//blog.rook.io/">Blog</a></li>
      <li><a class="button small" href="/docs/rook/v1.9/quickstart.html">Get Started</a></li>
    </ul>
  </div>
</nav>

    <main id="content" aria-label="Content"><div>



















<section class="docs-header">
  <h1>Ceph</h1>
  <div class="versions">
    <a role="button" href="javascript:void(0)">Rook Ceph v0.8</a>
    <div class="versions-dropdown-content">
      
        <a href="/docs/rook/v1.9/upgrade-patch.html">Rook Ceph v1.9</a>
      
        <a href="/docs/rook/v1.8/upgrade-patch.html">Rook Ceph v1.8</a>
      
        <a href="/docs/rook/v1.7/upgrade-patch.html">Rook Ceph v1.7</a>
      
        <a href="/docs/rook/v1.6/upgrade-patch.html">Rook Ceph v1.6</a>
      
        <a href="/docs/rook/v1.5/upgrade-patch.html">Rook Ceph v1.5</a>
      
        <a href="/docs/rook/v1.4/upgrade-patch.html">Rook Ceph v1.4</a>
      
        <a href="/docs/rook/v1.3/upgrade-patch.html">Rook Ceph v1.3</a>
      
        <a href="/docs/rook/v1.2/upgrade-patch.html">Rook Ceph v1.2</a>
      
        <a href="/docs/rook/v1.1/upgrade-patch.html">Rook Ceph v1.1</a>
      
        <a href="/docs/rook/v1.0/upgrade-patch.html">Rook Ceph v1.0</a>
      
        <a href="/docs/rook/v0.9/upgrade-patch.html">Rook Ceph v0.9</a>
      
        <a href="/docs/rook/v0.8/upgrade-patch.html" class="active">Rook Ceph v0.8</a>
      
        <a href="/docs/rook/v0.7/upgrade-patch.html">Rook Ceph v0.7</a>
      
        <a href="/docs/rook/v0.6/upgrade-patch.html">Rook Ceph v0.6</a>
      
        <a href="/docs/rook/v0.5/upgrade-patch.html">Rook Ceph v0.5</a>
      
        <a href="/docs/rook/latest/upgrade-patch.html">Rook Ceph latest</a>
      
    </div>
    <img src="/images/arrow.svg" />
  </div>
</section>
<div class="page">
  <div class="docs-menu">
      <ul id="docs-ul"></ul>
  </div>
  <div class="docs-content">
    <div class="docs-actions">
      <a id="edit" href="https://github.com/rook/rook/blob/master/Documentation/upgrade-patch.md">Edit on GitHub</a>
    </div>
    
      <div class="alert old">
        <p><b>PLEASE NOTE</b>: This document applies to v0.8 version and not to the latest <strong>stable</strong> release v1.9</p>
      </div>
    
    <div class="docs-text">
      <h1 id="08-patch-upgrades">0.8 Patch Upgrades</h1>

<p>The changes in patch releases are scoped to the minimal changes necessary and are expected to be straight forward to upgrade.
This guide will walk you through the manual steps to upgrade the software in a Rook cluster from an 0.8 version to another patched version of 0.8.
For example, upgrade from <code class="language-plaintext highlighter-rouge">v0.8.0</code> to <code class="language-plaintext highlighter-rouge">v0.8.1</code>.</p>

<p>After each component is upgraded, it is important to verify that the cluster returns to a healthy and fully functional state.</p>

<h2 id="considerations">Considerations</h2>
<p>With this manual upgrade guide, there are a few notes to consider:</p>
<ul>
  <li><strong>WARNING:</strong> Upgrading a Rook cluster is a manual process in its very early stages.  There may be unexpected issues or obstacles that damage the integrity and health of your storage cluster, including data loss.</li>
  <li>This guide assumes that your Rook operator and its agents are running in the <code class="language-plaintext highlighter-rouge">rook-ceph-system</code> namespace. It also assumes that your Rook cluster is in the <code class="language-plaintext highlighter-rouge">rook-ceph</code> namespace.  If any of these components is in a different namespace, search/replace all instances of <code class="language-plaintext highlighter-rouge">-n rook-ceph-system</code> and <code class="language-plaintext highlighter-rouge">-n rook-ceph</code> in this guide with <code class="language-plaintext highlighter-rouge">-n &lt;your namespace&gt;</code>.</li>
</ul>

<h2 id="prerequisites">Prerequisites</h2>
<p>In order to successfully upgrade a Rook cluster, the following prerequisites must be met:</p>
<ul>
  <li>The cluster should be in a healthy state with full functionality.
Review the <a href="/docs/rook/v0.8/upgrade.html#health-verification">health verification section</a> in the main upgrade guide in order to verify your cluster is in a good starting state.</li>
  <li>All pods consuming Rook storage should be created, running, and in a steady state.  No Rook persistent volumes should be in the act of being created or deleted.</li>
</ul>

<h2 id="upgrade-process">Upgrade Process</h2>
<p>The general flow of the upgrade process will be to upgrade the version of a Rook pod, verify the pod is running with the new version, then verify that the overall cluster health is still in a good state.</p>

<p>In this guide, we will be upgrading a live Rook cluster running <code class="language-plaintext highlighter-rouge">v0.8.0</code> to version <code class="language-plaintext highlighter-rouge">v0.8.1</code>.</p>

<h3 id="operator">Operator</h3>
<p>The operator controls upgrading all the components and is generally the first component to be updated.
The operator can be updated by setting the deployment version.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl <span class="nt">-n</span> rook-ceph-system <span class="nb">set </span>image deploy/rook-ceph-operator rook-ceph-operator<span class="o">=</span>rook/ceph:v0.8.1
</code></pre></div></div>

<p>The operator pod will automatically be restarted by Kubernetes with the new version.</p>

<p>Once you’ve verified the operator is <code class="language-plaintext highlighter-rouge">Running</code> and on the new version, verify the health of the cluster is still OK.
Instructions for verifying cluster health can be found in the <a href="/docs/rook/v0.8/upgrade.html#health-verification">health verification section</a>.</p>

<h3 id="system-daemons">System Daemons</h3>
<p>The pods in the rook-ceph-system namespace will all be updated automatically when the operator is updated. After the operator is updated, you will see the <code class="language-plaintext highlighter-rouge">rook-ceph-agent</code> and <code class="language-plaintext highlighter-rouge">rook-discover</code> pods restarted on the new version.</p>

<h3 id="monitors">Monitors</h3>
<p>There are multiple monitor pods to upgrade and they are each individually managed by their own replica set.
<strong>For each</strong> monitor’s replica set, you will need to update the pod template spec’s image version field to <code class="language-plaintext highlighter-rouge">rook/ceph:v0.8.1</code>.
For example, we can update the replica set for <code class="language-plaintext highlighter-rouge">mon0</code> with:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl <span class="nt">-n</span> rook-ceph <span class="nb">set </span>image replicaset/rook-ceph-mon0 rook-ceph-mon<span class="o">=</span>rook/ceph:v0.8.1
</code></pre></div></div>

<p>Once the replica set has been updated, we need to manually terminate the old pod which will trigger the replica set to create a new pod using the new version.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl <span class="nt">-n</span> rook-ceph delete pod <span class="nt">-l</span> <span class="nv">mon</span><span class="o">=</span>rook-ceph-mon0
</code></pre></div></div>

<p>At this point, it’s very important to ensure that all monitors are <code class="language-plaintext highlighter-rouge">OK</code> and <code class="language-plaintext highlighter-rouge">in quorum</code>.
Refer to the <a href="/docs/rook/v0.8/upgrade.html#status-output">status output section</a> for instructions.
If all of the monitors (and the cluster health overall) look good, then we can move on and repeat the same upgrade steps for the next monitor until all are completed.</p>

<h3 id="object-storage-daemons-osds">Object Storage Daemons (OSDs)</h3>
<p>The automatic upgrade of OSD pods has been implemented by the operator. Within a minute of starting the operator on the new version, you should see the osd pods automatically started on the new version.
Going forward, if there is any change needed to the OSD deployment as determined by the operator, the OSD pods will automatically be updated and restarted.
For example, the OSDs will be automatically updated when:</p>
<ul>
  <li>The version of the operator container changes</li>
  <li>The <code class="language-plaintext highlighter-rouge">resources</code> or <code class="language-plaintext highlighter-rouge">placement</code> elements are changed in the cluster CRD</li>
</ul>

<p>One by one, as each of the OSDs are updated the operator will wait for the OSD pod to be running again before continuing with the next OSD.
In some scenarios, the operator will need to be restarted in order to apply the changes to the OSD deployment specs.</p>

<h3 id="ceph-manager">Ceph Manager</h3>
<p>To update the Ceph mgrs, edit the deployment image version:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl <span class="nt">-n</span> rook-ceph <span class="nb">set </span>image deploy/rook-ceph-mgr-a rook-ceph-mgr-a<span class="o">=</span>rook/ceph:v0.8.1
</code></pre></div></div>

<h4 id="object-storage-rgw">Object Storage (RGW)</h4>
<p>If you have object storage installed, edit the RGW deployment to use the new image version:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl <span class="nt">-n</span> rook-ceph <span class="nb">set </span>image deploy/rook-ceph-rgw-my-store rook-ceph-rgw-my-store<span class="o">=</span>rook/ceph:v0.8.1
</code></pre></div></div>

<h4 id="shared-file-system-mds">Shared File System (MDS)</h4>
<p>If you have a shared file system installed, edit the MDS deployment to use the new image version:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl <span class="nt">-n</span> rook-ceph <span class="nb">set </span>image deploy/rook-ceph-mds-myfs rook-ceph-mds-myfs<span class="o">=</span>rook/ceph:v0.8.1
</code></pre></div></div>

<h2 id="completion">Completion</h2>
<p>At this point, your Rook cluster should be fully upgraded to running version <code class="language-plaintext highlighter-rouge">rook/ceph:v0.8.1</code> and the cluster should be healthy according to the steps in the <a href="/docs/rook/v0.8/upgrade.html#health-verification">health verification section</a>.</p>

    </div>
  </div>
</div>

<script>
  var menu = [];
  var BASE_PATH = "";

  function add(name, url, isChild, current) {
    var item = { name: name, url: url, current: current };
    var container = menu;
    if (isChild && menu.length > 0) {
      menu[menu.length-1].children = menu[menu.length-1].children || [];
      container = menu[menu.length-1].children;
      if (current) {
        menu[menu.length-1].childCurrent = true;
      }
    }
    container.push(item);
  }

  
    add(
      "Rook",
      "/docs/rook/v0.8/",
      false,
      false
    );
  
    add(
      "Quickstart",
      "/docs/rook/v0.8/quickstart-toc.html",
      false,
      false
    );
  
    add(
      "Ceph Storage",
      "/docs/rook/v0.8/ceph-quickstart.html",
      true,
      false
    );
  
    add(
      "Ceph Cleanup",
      "/docs/rook/v0.8/ceph-teardown.html",
      true,
      false
    );
  
    add(
      "CockroachDB",
      "/docs/rook/v0.8/cockroachdb.html",
      true,
      false
    );
  
    add(
      "Minio Object Store",
      "/docs/rook/v0.8/minio-object-store.html",
      true,
      false
    );
  
    add(
      "Prerequisites",
      "/docs/rook/v0.8/k8s-pre-reqs.html",
      false,
      false
    );
  
    add(
      "FlexVolume Configuration",
      "/docs/rook/v0.8/flexvolume.html",
      true,
      false
    );
  
    add(
      "RBAC Security",
      "/docs/rook/v0.8/rbac.html",
      true,
      false
    );
  
    add(
      "Tectonic Bare Metal",
      "/docs/rook/v0.8/tectonic.html",
      true,
      false
    );
  
    add(
      "OpenShift",
      "/docs/rook/v0.8/openshift.html",
      true,
      false
    );
  
    add(
      "Ceph Storage",
      "/docs/rook/v0.8/storage.html",
      false,
      false
    );
  
    add(
      "Block Storage",
      "/docs/rook/v0.8/block.html",
      true,
      false
    );
  
    add(
      "Object Storage",
      "/docs/rook/v0.8/object.html",
      true,
      false
    );
  
    add(
      "Shared File System",
      "/docs/rook/v0.8/filesystem.html",
      true,
      false
    );
  
    add(
      "Custom Resources",
      "/docs/rook/v0.8/crds.html",
      false,
      false
    );
  
    add(
      "Ceph Cluster",
      "/docs/rook/v0.8/ceph-cluster-crd.html",
      true,
      false
    );
  
    add(
      "Ceph Pool",
      "/docs/rook/v0.8/ceph-pool-crd.html",
      true,
      false
    );
  
    add(
      "Ceph Object Store",
      "/docs/rook/v0.8/ceph-object-store-crd.html",
      true,
      false
    );
  
    add(
      "Ceph Shared File System",
      "/docs/rook/v0.8/ceph-filesystem-crd.html",
      true,
      false
    );
  
    add(
      "CockroachDB Cluster",
      "/docs/rook/v0.8/cockroachdb-cluster-crd.html",
      true,
      false
    );
  
    add(
      "Minio Object Store CRD",
      "/docs/rook/v0.8/minio-object-store-crd.html",
      true,
      false
    );
  
    add(
      "Monitoring",
      "/docs/rook/v0.8/monitoring.html",
      false,
      false
    );
  
    add(
      "Ceph Dashboard",
      "/docs/rook/v0.8/ceph-dashboard.html",
      true,
      false
    );
  
    add(
      "Helm Charts",
      "/docs/rook/v0.8/helm.html",
      false,
      false
    );
  
    add(
      "Ceph Operator",
      "/docs/rook/v0.8/helm-operator.html",
      true,
      false
    );
  
    add(
      "Upgrades",
      "/docs/rook/v0.8/upgrade.html",
      false,
      false
    );
  
    add(
      "Patch Upgrades",
      "/docs/rook/v0.8/upgrade-patch.html",
      true,
      true
    );
  
    add(
      "Tools",
      "/docs/rook/v0.8/tools.html",
      false,
      false
    );
  
    add(
      "Toolbox",
      "/docs/rook/v0.8/toolbox.html",
      true,
      false
    );
  
    add(
      "Direct Tools",
      "/docs/rook/v0.8/direct-tools.html",
      true,
      false
    );
  
    add(
      "Advanced Configuration",
      "/docs/rook/v0.8/advanced-configuration.html",
      true,
      false
    );
  
    add(
      "Common Issues",
      "/docs/rook/v0.8/common-issues.html",
      true,
      false
    );
  
    add(
      "Container Linux",
      "/docs/rook/v0.8/container-linux.html",
      true,
      false
    );
  
    add(
      "Disaster Recovery",
      "/docs/rook/v0.8/disaster-recovery.html",
      true,
      false
    );
  
    add(
      "Contributing",
      "/docs/rook/v0.8/development-flow.html",
      false,
      false
    );
  
    add(
      "Multi-Node Test Environment",
      "/docs/rook/v0.8/development-environment.html",
      true,
      false
    );
  

  function getEntry(item) {
    var itemDom = document.createElement('li');

    if (item.current) {
      itemDom.innerHTML = item.name;
      itemDom.classList.add('current');
    } else {
      itemDom.innerHTML = '<a href="' + item.url + '">' + item.name + '</a>';
    }

    return itemDom;
  }

  // Flush css changes as explained in: https://stackoverflow.com/a/34726346
  // and more completely: https://stackoverflow.com/a/6956049
  function flushCss(element) {
    element.offsetHeight;
  }

  function addArrow(itemDom) {
    var MAIN_ITEM_HEIGHT = 24;
    var BOTTOM_PADDING = 20;
    var arrowDom = document.createElement('a');
    arrowDom.classList.add('arrow');
    arrowDom.innerHTML = '<img src="' + BASE_PATH + '/images/arrow.svg" />';
    arrowDom.onclick = function(itemDom) {
      return function () {
        // Calculated full height of the opened list
        var fullHeight = MAIN_ITEM_HEIGHT + BOTTOM_PADDING + itemDom.lastChild.clientHeight + 'px';

        itemDom.classList.toggle('open');

        if (itemDom.classList.contains('open')) {
          itemDom.style.height = fullHeight;
        } else {
          // If the list height is auto we have to set it to fullHeight
          // without tranistion before we shrink it to collapsed height
          if (itemDom.style.height === 'auto') {
            itemDom.style.transition = 'none';
            itemDom.style.height = fullHeight;
            flushCss(itemDom);
            itemDom.style.transition = '';
          }
          itemDom.style.height = MAIN_ITEM_HEIGHT + 'px';
        }

        return false;
      };
    }(itemDom);
    itemDom.appendChild(arrowDom);

    if ((item.current && item.children) || item.childCurrent) {
      itemDom.classList.add('open');
      itemDom.style.height = 'auto';
    } else {
      itemDom.style.height = MAIN_ITEM_HEIGHT + 'px';
    }
  }

  var menuDom = document.getElementById('docs-ul');
  for (var i = 0; i < menu.length; i++) {
    var item = menu[i];
    var itemDom = getEntry(item);

    if (item.childCurrent) {
      itemDom.classList.add('childCurrent');
    }

    if (item.children) {
      addArrow(itemDom);
      itemDom.classList.add('children');
      var children = document.createElement('ul');
      for (var j = 0; j < item.children.length; j++) {
        children.appendChild(getEntry(item.children[j]));
      }
      itemDom.appendChild(children);
    }
    menuDom.appendChild(itemDom);
  }
</script>
</div></main>
    <footer id="footer" aria-label="Footer">
  <div class="top">
    <a href="//www.cncf.io">
      <img
        class="cncf"
        src="/images/cncf.png"
        srcset="/images/cncf@2x.png 2x, /images/cncf@3x.png 3x" />
    </a>
    <p>We are a Cloud Native Computing Foundation graduated project.</p>
  </div>
  <div class="middle">
    <div class="grid-center">
      <div class="col_sm-12">
        <span>Getting Started</span>
        <a href="//github.com/rook/rook">GitHub</a>
        <a href="/docs/rook/v1.9/">Documentation</a>
        <a href="//github.com/rook/rook/blob/master/CONTRIBUTING.md#how-to-contribute">How to Contribute</a>
      </div>
      <div class="col_sm-12">
        <span>Community</span>
        <a href="//slack.rook.io/">Slack</a>
        <a href="//twitter.com/rook_io">Twitter</a>
        <a href="//groups.google.com/forum/#!forum/rook-dev">Forum</a>
        <a href="//blog.rook.io/">Blog</a>
      </div>
      <div class="col_sm-12">
        <span>Contact</span>
        <a href="mailto:cncf-rook-info@lists.cncf.io">Email</a>
        <a href="//github.com/rook/rook/issues">Feature request</a>
      </div>
      <div class="col_sm-12">
        <span>Top Contributors</span>
        <a href="//cloudical.io/">Cloudical</a>
        <a href="//cybozu.com">Cybozu, Inc</a>
        <a href="//www.redhat.com">Red Hat</a>
        <a href="//www.suse.com/">SUSE</a>
        <a href="//upbound.io">Upbound</a>
      </div>
    </div>
  </div>
  <div class="bottom">
    <div class="grid-center">
      <div class="col-8">
        <a class="logo" href="/">
          <img src="/images/rook-logo-small.svg" alt="rook.io" />
        </a>
        <p>
          &#169; Rook Authors 2022. Documentation distributed under
          <a href="https://creativecommons.org/licenses/by/4.0">CC-BY-4.0</a>.
        </p>
        <p>
          &#169; 2022 The Linux Foundation. All rights reserved. The Linux Foundation has
          registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our
          <a href="https://www.linuxfoundation.org/trademark-usage/">Trademark Usage</a> page.
        </p>
      </div>
    </div>
  </div>
</footer>


  <script src="/js/anchor.js"></script>
  <script>
    anchors.options = {
      placement: 'right',
      icon: '#',
    }

    document.addEventListener('DOMContentLoaded', function(event) {
      anchors.add('.docs-text h1, .docs-text h2, .docs-text h3, .docs-text h4, .docs-text h5, .docs-text h6');
    });
  </script>




    
  </body>
</html>
