












































<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />

    
    <meta name="robots" content="noindex">
    

    <title>Ceph Docs</title>

    <link rel="canonical" href="https://rook.io/docs/rook/v0.9/ceph-cluster-crd.html">

    <link rel="icon" href="/favicon.ico" />
<link rel="icon" type="image/png" href="/images/favicon_16x16.png" sizes="16x16" />
<link rel="icon" type="image/png" href="/images/favicon_32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="/images/favicon_48x48.png" sizes="48x48" />
<link rel="icon" type="image/png" href="/images/favicon_192x192.png" sizes="192x192" />


    <link href="//fonts.googleapis.com/css?family=Montserrat:500|Open+Sans:300,400,600" rel="stylesheet">
    
    <link rel="stylesheet" href="/css/main.css">
    
      <link rel="stylesheet" href="/css/docs.css" />
    
  </head>
  <body>
    <nav id="navigation" aria-label="Navigation">
  <div>
    <div class="logo">
      <a href="/"><img src="/images/rook-logo.svg"/></a>
    </div>
    <div
      class="hamburger-controls"
      onclick="if (document.body.classList.contains('menu-open')) { document.body.classList.remove('menu-open') } else { document.body.classList.add('menu-open') }; return false;">
      <span></span> <span></span> <span></span>
    </div>
    <ul class="links">
      <li class="dropdown">
        <a role="button" href="javascript:void(0)">Documentation</a>
        <div class="dropdown-content">
          <a href="/docs/rook/v1.9/">Ceph</a>
          <a href="/docs/cassandra/v1.7/">Cassandra</a>
          <a href="/docs/nfs/v1.7/">NFS</a>
        </div>
      <li class="dropdown">
        <a role="button" href="javascript:void(0)">Community</a>
        <div class="dropdown-content">
          <a href="//github.com/rook/rook">GitHub</a>
          <a href="//slack.rook.io/">Slack</a>
          <a href="//groups.google.com/forum/#!forum/rook-dev">Forum</a>
          <a href="//twitter.com/rook_io">Twitter</a>
        </div>
      </li>
      <li><a href="//blog.rook.io/">Blog</a></li>
      <li><a class="button small" href="/docs/rook/v1.9/quickstart.html">Get Started</a></li>
    </ul>
  </div>
</nav>

    <main id="content" aria-label="Content"><div>



















<section class="docs-header">
  <h1>Ceph</h1>
  <div class="versions">
    <a role="button" href="javascript:void(0)">Rook Ceph v0.9</a>
    <div class="versions-dropdown-content">
      
        <a href="/docs/rook/v1.9/ceph-cluster-crd.html">Rook Ceph v1.9</a>
      
        <a href="/docs/rook/v1.8/ceph-cluster-crd.html">Rook Ceph v1.8</a>
      
        <a href="/docs/rook/v1.7/ceph-cluster-crd.html">Rook Ceph v1.7</a>
      
        <a href="/docs/rook/v1.6/ceph-cluster-crd.html">Rook Ceph v1.6</a>
      
        <a href="/docs/rook/v1.5/ceph-cluster-crd.html">Rook Ceph v1.5</a>
      
        <a href="/docs/rook/v1.4/ceph-cluster-crd.html">Rook Ceph v1.4</a>
      
        <a href="/docs/rook/v1.3/ceph-cluster-crd.html">Rook Ceph v1.3</a>
      
        <a href="/docs/rook/v1.2/ceph-cluster-crd.html">Rook Ceph v1.2</a>
      
        <a href="/docs/rook/v1.1/ceph-cluster-crd.html">Rook Ceph v1.1</a>
      
        <a href="/docs/rook/v1.0/ceph-cluster-crd.html">Rook Ceph v1.0</a>
      
        <a href="/docs/rook/v0.9/ceph-cluster-crd.html" class="active">Rook Ceph v0.9</a>
      
        <a href="/docs/rook/v0.8/ceph-cluster-crd.html">Rook Ceph v0.8</a>
      
        <a href="/docs/rook/v0.7/ceph-cluster-crd.html">Rook Ceph v0.7</a>
      
        <a href="/docs/rook/v0.6/ceph-cluster-crd.html">Rook Ceph v0.6</a>
      
        <a href="/docs/rook/v0.5/ceph-cluster-crd.html">Rook Ceph v0.5</a>
      
        <a href="/docs/rook/latest/ceph-cluster-crd.html">Rook Ceph latest</a>
      
    </div>
    <img src="/images/arrow.svg" />
  </div>
</section>
<div class="page">
  <div class="docs-menu">
      <ul id="docs-ul"></ul>
  </div>
  <div class="docs-content">
    <div class="docs-actions">
      <a id="edit" href="https://github.com/rook/rook/blob/master/Documentation/ceph-cluster-crd.md">Edit on GitHub</a>
    </div>
    
      <div class="alert old">
        <p><b>PLEASE NOTE</b>: This document applies to v0.9 version and not to the latest <strong>stable</strong> release v1.9</p>
      </div>
    
    <div class="docs-text">
      <h1 id="ceph-cluster-crd">Ceph Cluster CRD</h1>
<p>Rook allows creation and customization of storage clusters through the custom resource definitions (CRDs).</p>

<h2 id="sample">Sample</h2>

<p>To get you started, here is a simple example of a CRD to configure a Ceph cluster with all nodes and all devices. More examples are included <a href="#samples">later in this doc</a>.</p>

<p><strong>NOTE</strong> In addition to your CephCluster object, you need to create RBAC rules for the namespace you are going to create the CephCluster in, see <a href="#common-cluster-resources">Common Cluster Resources</a> section below.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">ceph.rook.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">CephCluster</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-ceph</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-ceph</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">cephVersion</span><span class="pi">:</span>
    <span class="c1"># see the "Cluster Settings" section below for more details on which image of ceph to run</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">ceph/ceph:v13.2.4-20190109</span>
  <span class="na">dataDirHostPath</span><span class="pi">:</span> <span class="s">/var/lib/rook</span>
  <span class="na">storage</span><span class="pi">:</span>
    <span class="na">useAllNodes</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">useAllDevices</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<p>In addition to the CRD, you will also need to create a namespace, role, and role binding as seen in the <a href="#common-cluster-resources">common cluster resources</a> below.</p>

<h2 id="settings">Settings</h2>
<p>Settings can be specified at the global level to apply to the cluster as a whole, while other settings can be specified at more fine-grained levels.  If any setting is unspecified, a suitable default will be used automatically.</p>

<h3 id="cluster-metadata">Cluster metadata</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">name</code>: The name that will be used internally for the Ceph cluster. Most commonly the name is the same as the namespace since multiple clusters are not supported in the same namespace.</li>
  <li><code class="language-plaintext highlighter-rouge">namespace</code>: The Kubernetes namespace that will be created for the Rook cluster. The services, pods, and other resources created by the operator will be added to this namespace. The common scenario is to create a single Rook cluster. If multiple clusters are created, they must not have conflicting devices or host paths.</li>
</ul>

<h3 id="cluster-settings">Cluster Settings</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">cephVersion</code>: The version information for launching the ceph daemons.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">image</code>: The image used for running the ceph daemons. For example, <code class="language-plaintext highlighter-rouge">ceph/ceph:v12.2.9-20181026</code> or <code class="language-plaintext highlighter-rouge">ceph/ceph:v13.2.4-20190109</code>.
For the latest ceph images, see the <a href="https://hub.docker.com/r/ceph/ceph/tags/">Ceph DockerHub</a>.
To ensure a consistent version of the image is running across all nodes in the cluster, it is recommended to use a very specific image version.
Tags also exist that would give the latest version, but they are only recommended for test environments. For example, the tag <code class="language-plaintext highlighter-rouge">v13</code> will be updated each time a new mimic build is released.
Using the <code class="language-plaintext highlighter-rouge">v13</code> or similar tag is not recommended in production because it may lead to inconsistent versions of the image running across different nodes in the cluster.</li>
      <li><code class="language-plaintext highlighter-rouge">allowUnsupported</code>: If <code class="language-plaintext highlighter-rouge">true</code>, allow an unsupported major version of the Ceph release. Currently only <code class="language-plaintext highlighter-rouge">luminous</code> and <code class="language-plaintext highlighter-rouge">mimic</code> are supported, so <code class="language-plaintext highlighter-rouge">nautilus</code> would require this to be set to <code class="language-plaintext highlighter-rouge">true</code>. Should be set to <code class="language-plaintext highlighter-rouge">false</code> in production.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">dataDirHostPath</code>: The path on the host (<a href="https://kubernetes.io/docs/concepts/storage/volumes/#hostpath">hostPath</a>) where config and data should be stored for each of the services. If the directory does not exist, it will be created. Because this directory persists on the host, it will remain after pods are deleted.
    <ul>
      <li>On <strong>Minikube</strong> environments, use <code class="language-plaintext highlighter-rouge">/data/rook</code>. Minikube boots into a tmpfs but it provides some <a href="https://github.com/kubernetes/minikube/blob/master/docs/persistent_volumes.md">directories</a> where files can be persisted across reboots. Using one of these directories will ensure that Rook’s data and configuration files are persisted and that enough storage space is available.</li>
      <li><strong>WARNING</strong>: For test scenarios, if you delete a cluster and start a new cluster on the same hosts, the path used by <code class="language-plaintext highlighter-rouge">dataDirHostPath</code> must be deleted. Otherwise, stale keys and other config will remain from the previous cluster and the new mons will fail to start.
If this value is empty, each pod will get an ephemeral directory to store their config files that is tied to the lifetime of the pod running on that node. More details can be found in the Kubernetes <a href="https://kubernetes.io/docs/concepts/storage/volumes/#emptydir">empty dir docs</a>.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">dashboard</code>: Settings for the Ceph dashboard. To view the dashboard in your browser see the <a href="/docs/rook/v0.9/ceph-dashboard.html">dashboard guide</a>.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">enabled</code>: Whether to enable the dashboard to view cluster status</li>
      <li><code class="language-plaintext highlighter-rouge">urlPrefix</code>: Allows to serve the dashboard under a subpath (useful when you are accessing the dashboard via a reverse proxy)</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">network</code>: The network settings for the cluster
    <ul>
      <li><code class="language-plaintext highlighter-rouge">hostNetwork</code>: uses network of the hosts instead of using the SDN below the containers.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">mon</code>: contains mon related options <a href="#mon-settings">mon settings</a>
For more details on the mons and when to choose a number other than <code class="language-plaintext highlighter-rouge">3</code>, see the <a href="https://github.com/rook/rook/blob/master/design/mon-health.md">mon health design doc</a>.</li>
  <li><code class="language-plaintext highlighter-rouge">rbdMirroring</code>: The settings for rbd mirror daemon(s). Configuring which pools or images to be mirrored must be completed in the rook toolbox by running the
<a href="http://docs.ceph.com/docs/mimic/rbd/rbd-mirroring/">rbd mirror</a> command.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">workers</code>: The number of rbd daemons to perform the rbd mirroring between clusters.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">placement</code>: <a href="#placement-configuration-settings">placement configuration settings</a></li>
  <li><code class="language-plaintext highlighter-rouge">resources</code>: <a href="#cluster-wide-resources-configuration-settings">resources configuration settings</a></li>
  <li><code class="language-plaintext highlighter-rouge">storage</code>: Storage selection and configuration that will be used across the cluster.  Note that these settings can be overridden for specific nodes.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">useAllNodes</code>: <code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code>, indicating if all nodes in the cluster should be used for storage according to the cluster level storage selection and configuration values.
If individual nodes are specified under the <code class="language-plaintext highlighter-rouge">nodes</code> field below, then <code class="language-plaintext highlighter-rouge">useAllNodes</code> must be set to <code class="language-plaintext highlighter-rouge">false</code>.</li>
      <li><code class="language-plaintext highlighter-rouge">nodes</code>: Names of individual nodes in the cluster that should have their storage included in accordance with either the cluster level configuration specified above or any node specific overrides described in the next section below.
<code class="language-plaintext highlighter-rouge">useAllNodes</code> must be set to <code class="language-plaintext highlighter-rouge">false</code> to use specific nodes and their config.</li>
      <li><code class="language-plaintext highlighter-rouge">config</code>: Config settings applied to all OSDs on the node unless overridden by <code class="language-plaintext highlighter-rouge">devices</code> or <code class="language-plaintext highlighter-rouge">directories</code>. See the <a href="#osd-configuration-settings">config settings</a> below.</li>
      <li><a href="#storage-selection-settings">storage selection settings</a></li>
    </ul>
  </li>
</ul>

<h4 id="node-updates">Node Updates</h4>
<p>Nodes can be added and removed over time by updating the Cluster CRD, for example with <code class="language-plaintext highlighter-rouge">kubectl -n rook-ceph edit cephcluster rook-ceph</code>.
This will bring up your default text editor and allow you to add and remove storage nodes from the cluster.
This feature is only available when <code class="language-plaintext highlighter-rouge">useAllNodes</code> has been set to <code class="language-plaintext highlighter-rouge">false</code>.</p>

<h3 id="mon-settings">Mon Settings</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">count</code>: set the number of mons to be started. The number should be odd and between <code class="language-plaintext highlighter-rouge">1</code> and <code class="language-plaintext highlighter-rouge">9</code>. If not specified the default is set to <code class="language-plaintext highlighter-rouge">3</code> and <code class="language-plaintext highlighter-rouge">allowMultiplePerNode</code> is also set to <code class="language-plaintext highlighter-rouge">true</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">allowMultiplePerNode</code>: enable (<code class="language-plaintext highlighter-rouge">true</code>) or disable (<code class="language-plaintext highlighter-rouge">false</code>) the placement of multiple mons on one node. Default is <code class="language-plaintext highlighter-rouge">false</code>.</li>
</ul>

<p>If these settings are changed in the CRD the operator will update the number of mons during a periodic check of the mon health, which by default is every 45 seconds.</p>

<p>To change the defaults that the operator uses to determine the mon health and whether to failover a mon, the following environment variables can be changed in <a href="https://github.com/rook/rook/blob/master/cluster/examples/kubernetes/ceph/operator.yaml">operator.yaml</a>. The intervals should be small enough that you have confidence the mons will maintain quorum, while also being
log enough to ignore network blips where mons are failed over too often.</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">ROOK_MON_HEALTHCHECK_INTERVAL</code>: The frequency with which to check if mons are in quorum (default is 45 seconds)</li>
  <li><code class="language-plaintext highlighter-rouge">ROOK_MON_OUT_TIMEOUT</code>: The interval to wait before marking a mon as “out” and starting a new mon to replace it in the quroum (default is 5 minutes)</li>
</ul>

<h3 id="node-settings">Node Settings</h3>
<p>In addition to the cluster level settings specified above, each individual node can also specify configuration to override the cluster level settings and defaults.
If a node does not specify any configuration then it will inherit the cluster level settings.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">name</code>: The name of the node, which should match its <code class="language-plaintext highlighter-rouge">kubernetes.io/hostname</code> label.</li>
  <li><code class="language-plaintext highlighter-rouge">config</code>: Config settings applied to all OSDs on the node unless overridden by <code class="language-plaintext highlighter-rouge">devices</code> or <code class="language-plaintext highlighter-rouge">directories</code>. See the <a href="#osd-configuration-settings">config settings</a> below.</li>
  <li><a href="#storage-selection-settings">storage selection settings</a></li>
</ul>

<h3 id="storage-selection-settings">Storage Selection Settings</h3>
<p>Below are the settings available, both at the cluster and individual node level, for selecting which storage resources will be included in the cluster.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">useAllDevices</code>: <code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code>, indicating whether all devices found on nodes in the cluster should be automatically consumed by OSDs. <strong>Not recommended</strong> unless you have a very controlled environment where you will not risk formatting of devices with existing data. When <code class="language-plaintext highlighter-rouge">true</code>, all devices will be used except those with partitions created or a local filesystem. Is overridden by <code class="language-plaintext highlighter-rouge">deviceFilter</code> if specified.</li>
  <li><code class="language-plaintext highlighter-rouge">deviceFilter</code>: A regular expression that allows selection of devices to be consumed by OSDs.  If individual devices have been specified for a node then this filter will be ignored.  This field uses <a href="https://golang.org/pkg/regexp/syntax/">golang regular expression syntax</a>. For example:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">sdb</code>: Only selects the <code class="language-plaintext highlighter-rouge">sdb</code> device if found</li>
      <li><code class="language-plaintext highlighter-rouge">^sd.</code>: Selects all devices starting with <code class="language-plaintext highlighter-rouge">sd</code></li>
      <li><code class="language-plaintext highlighter-rouge">^sd[a-d]</code>: Selects devices starting with <code class="language-plaintext highlighter-rouge">sda</code>, <code class="language-plaintext highlighter-rouge">sdb</code>, <code class="language-plaintext highlighter-rouge">sdc</code>, and <code class="language-plaintext highlighter-rouge">sdd</code> if found</li>
      <li><code class="language-plaintext highlighter-rouge">^s</code>: Selects all devices that start with <code class="language-plaintext highlighter-rouge">s</code></li>
      <li><code class="language-plaintext highlighter-rouge">^[^r]</code>: Selects all devices that do <em>not</em> start with <code class="language-plaintext highlighter-rouge">r</code></li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">devices</code>: A list of individual device names belonging to this node to include in the storage cluster.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">name</code>: The name of the device (e.g., <code class="language-plaintext highlighter-rouge">sda</code>).</li>
      <li><code class="language-plaintext highlighter-rouge">config</code>: Device-specific config settings. See the <a href="#osd-configuration-settings">config settings</a> below.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">directories</code>:  A list of directory paths that will be included in the storage cluster. Note that using two directories on the same physical device can cause a negative performance impact.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">path</code>: The path on disk of the directory (e.g., <code class="language-plaintext highlighter-rouge">/rook/storage-dir</code>).</li>
      <li><code class="language-plaintext highlighter-rouge">config</code>: Directory-specific config settings. See the <a href="#osd-configuration-settings">config settings</a> below.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">location</code>: Location information about the cluster to help with data placement, such as region or data center.  This is directly fed into the underlying Ceph CRUSH map.  More information on CRUSH maps can be found in the <a href="http://docs.ceph.com/docs/master/rados/operations/crush-map/">ceph docs</a>.</li>
</ul>

<h3 id="osd-configuration-settings">OSD Configuration Settings</h3>
<p>The following storage selection settings are specific to Ceph and do not apply to other backends. All variables are key-value pairs represented as strings.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">metadataDevice</code>: Name of a device to use for the metadata of OSDs on each node.  Performance can be improved by using a low latency device (such as SSD or NVMe) as the metadata device, while other spinning platter (HDD) devices on a node are used to store data.</li>
  <li><code class="language-plaintext highlighter-rouge">storeType</code>: <code class="language-plaintext highlighter-rouge">filestore</code> or <code class="language-plaintext highlighter-rouge">bluestore</code>, the underlying storage format to use for each OSD. The default is set dynamically to <code class="language-plaintext highlighter-rouge">bluestore</code> for devices, while <code class="language-plaintext highlighter-rouge">filestore</code> is the default for directories. Set this store type explicitly to override the default. Warning: Bluestore is <strong>not</strong> recommended for directories in production. Bluestore does not purge data from the directory and over time will grow without the ability to compact or shrink.</li>
  <li><code class="language-plaintext highlighter-rouge">databaseSizeMB</code>:  The size in MB of a bluestore database. Include quotes around the size.</li>
  <li><code class="language-plaintext highlighter-rouge">walSizeMB</code>:  The size in MB of a bluestore write ahead log (WAL). Include quotes around the size.</li>
  <li><code class="language-plaintext highlighter-rouge">journalSizeMB</code>:  The size in MB of a filestore journal. Include quotes around the size.</li>
  <li><code class="language-plaintext highlighter-rouge">osdsPerDevice</code>**: The number of OSDs to create on each device. High performance devices such as NVMe can handle running multiple OSDs. If desired, this can be overridden for each node and each device.</li>
</ul>

<p>** <strong>NOTE:</strong> Depending on the Ceph image running in your cluster, OSDs will be configured differently. Newer images will configure OSDs with <code class="language-plaintext highlighter-rouge">ceph-volume</code>, which provides support for <code class="language-plaintext highlighter-rouge">osdsPerDevice</code> as well as other features that will be exposed in future Rook releases. OSDs created prior to Rook v0.9 or with older images of Luminous and Mimic are not created with <code class="language-plaintext highlighter-rouge">ceph-volume</code> and thus would not support the same features. For <code class="language-plaintext highlighter-rouge">ceph-volume</code>, the following images are supported:</p>
<ul>
  <li>Luminous 12.2.10 or newer</li>
  <li>Mimic 13.2.3 or newer</li>
  <li>Nautilus</li>
</ul>

<h3 id="placement-configuration-settings">Placement Configuration Settings</h3>
<p>Placement configuration for the cluster services. It includes the following keys: <code class="language-plaintext highlighter-rouge">mgr</code>, <code class="language-plaintext highlighter-rouge">mon</code>, <code class="language-plaintext highlighter-rouge">osd</code> and <code class="language-plaintext highlighter-rouge">all</code>. Each service will have its placement configuration generated by merging the generic configuration under <code class="language-plaintext highlighter-rouge">all</code> with the most specific one (which will override any attributes).</p>

<p>A Placement configuration is specified (according to the kubernetes PodSpec) as:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">nodeAffinity</code>: kubernetes <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#node-affinity-beta-feature">NodeAffinity</a></li>
  <li><code class="language-plaintext highlighter-rouge">podAffinity</code>: kubernetes <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#inter-pod-affinity-and-anti-affinity-beta-feature">PodAffinity</a></li>
  <li><code class="language-plaintext highlighter-rouge">podAntiAffinity</code>: kubernetes <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#inter-pod-affinity-and-anti-affinity-beta-feature">PodAntiAffinity</a></li>
  <li><code class="language-plaintext highlighter-rouge">tolerations</code>: list of kubernetes <a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/">Toleration</a></li>
</ul>

<p>The <code class="language-plaintext highlighter-rouge">mon</code> pod does not allow <code class="language-plaintext highlighter-rouge">Pod</code> affinity or anti-affinity.
This is because of the mons having built-in anti-affinity with each other through the operator. The operator chooses which nodes are to run a mon on. Each mon is then tied to a node with a node selector using a hostname.
See the <a href="https://github.com/rook/rook/blob/master/design/mon-health.md">mon design doc</a> for more details on the mon failover design.</p>

<h3 id="cluster-wide-resources-configuration-settings">Cluster-wide Resources Configuration Settings</h3>
<p>Resources should be specified so that the rook components are handled after <a href="https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/">Kubernetes Pod Quality of Service classes</a>.
This allows to keep rook components running when for example a node runs out of memory and the rook components are not killed depending on their Quality of Service class.</p>

<p>You can set resource requests/limits for rook components through the <a href="#resource-requirementslimits">Resource Requirements/Limits</a> structure in the following keys:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">mgr</code>: Set resource requests/limits for MGRs.</li>
  <li><code class="language-plaintext highlighter-rouge">mon</code>: Set resource requests/limits for Mons.</li>
  <li><code class="language-plaintext highlighter-rouge">osd</code>: Set resource requests/limits for OSDs.</li>
</ul>

<h3 id="resource-requirementslimits">Resource Requirements/Limits</h3>
<p>For more information on resource requests/limits see the official Kubernetes documentation: <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#resource-requests-and-limits-of-pod-and-container">Kubernetes - Managing Compute Resources for Containers</a></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">requests</code>: Requests for cpu or memory.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">cpu</code>: Request for CPU (example: one CPU core <code class="language-plaintext highlighter-rouge">1</code>, 50% of one CPU core <code class="language-plaintext highlighter-rouge">500m</code>).</li>
      <li><code class="language-plaintext highlighter-rouge">memory</code>: Limit for Memory (example: one gigabyte of memory <code class="language-plaintext highlighter-rouge">1Gi</code>, half a gigabyte of memory <code class="language-plaintext highlighter-rouge">512Mi</code>).</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">limits</code>: Limits for cpu or memory.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">cpu</code>: Limit for CPU (example: one CPU core <code class="language-plaintext highlighter-rouge">1</code>, 50% of one CPU core <code class="language-plaintext highlighter-rouge">500m</code>).</li>
      <li><code class="language-plaintext highlighter-rouge">memory</code>: Limit for Memory (example: one gigabyte of memory <code class="language-plaintext highlighter-rouge">1Gi</code>, half a gigabyte of memory <code class="language-plaintext highlighter-rouge">512Mi</code>).</li>
    </ul>
  </li>
</ul>

<h2 id="samples">Samples</h2>
<p>Here are several samples for configuring Ceph clusters. Each of the samples must also include the namespace and corresponding access granted for management by the Ceph operator. See the <a href="#common-cluster-resources">common cluster resources</a> below.</p>

<h3 id="storage-configuration-all-devices">Storage configuration: All devices</h3>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">ceph.rook.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">CephCluster</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-ceph</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-ceph</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">cephVersion</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">ceph/ceph:v13.2.4-20190109</span>
  <span class="na">dataDirHostPath</span><span class="pi">:</span> <span class="s">/var/lib/rook</span>
  <span class="na">network</span><span class="pi">:</span>
    <span class="na">hostNetwork</span><span class="pi">:</span> <span class="no">false</span>
  <span class="na">dashboard</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
  <span class="c1"># cluster level storage configuration and selection</span>
  <span class="na">storage</span><span class="pi">:</span>
    <span class="na">useAllNodes</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">useAllDevices</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">deviceFilter</span><span class="pi">:</span>
    <span class="na">location</span><span class="pi">:</span>
    <span class="na">config</span><span class="pi">:</span>
      <span class="na">metadataDevice</span><span class="pi">:</span>
      <span class="na">databaseSizeMB</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1024"</span> <span class="c1"># this value can be removed for environments with normal sized disks (100 GB or larger)</span>
      <span class="na">journalSizeMB</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1024"</span>  <span class="c1"># this value can be removed for environments with normal sized disks (20 GB or larger)</span>
      <span class="na">osdsPerDevice</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1"</span>
</code></pre></div></div>

<h3 id="storage-configuration-specific-devices">Storage Configuration: Specific devices</h3>
<p>Individual nodes and their config can be specified so that only the named nodes below will be used as storage resources.
Each node’s ‘name’ field should match their ‘kubernetes.io/hostname’ label.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">ceph.rook.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">CephCluster</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-ceph</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-ceph</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">cephVersion</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">ceph/ceph:v13.2.4-20190109</span>
  <span class="na">dataDirHostPath</span><span class="pi">:</span> <span class="s">/var/lib/rook</span>
  <span class="na">network</span><span class="pi">:</span>
    <span class="na">hostNetwork</span><span class="pi">:</span> <span class="no">false</span>
  <span class="na">dashboard</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
  <span class="c1"># cluster level storage configuration and selection</span>
  <span class="na">storage</span><span class="pi">:</span>
    <span class="na">useAllNodes</span><span class="pi">:</span> <span class="no">false</span>
    <span class="na">useAllDevices</span><span class="pi">:</span> <span class="no">false</span>
    <span class="na">deviceFilter</span><span class="pi">:</span>
    <span class="na">location</span><span class="pi">:</span>
    <span class="na">config</span><span class="pi">:</span>
      <span class="na">metadataDevice</span><span class="pi">:</span>
      <span class="na">databaseSizeMB</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1024"</span> <span class="c1"># this value can be removed for environments with normal sized disks (100 GB or larger)</span>
      <span class="na">journalSizeMB</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1024"</span>  <span class="c1"># this value can be removed for environments with normal sized disks (20 GB or larger)</span>
    <span class="na">nodes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">172.17.4.101"</span>
      <span class="na">directories</span><span class="pi">:</span>         <span class="c1"># specific directories to use for storage can be specified for each node</span>
      <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/rook/storage-dir"</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">172.17.4.201"</span>
      <span class="na">devices</span><span class="pi">:</span>             <span class="c1"># specific devices to use for storage can be specified for each node</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">sdb"</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">sdc"</span>
      <span class="na">config</span><span class="pi">:</span>         <span class="c1"># configuration can be specified at the node level which overrides the cluster level config</span>
        <span class="na">storeType</span><span class="pi">:</span> <span class="s">bluestore</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">172.17.4.301"</span>
      <span class="na">deviceFilter</span><span class="pi">:</span> <span class="s2">"</span><span class="s">^sd."</span>
</code></pre></div></div>

<h3 id="storage-configuration-cluster-wide-directories">Storage Configuration: Cluster wide Directories</h3>
<p>This example is based up on the <a href="#storage-configuration-specific-devices">Storage Configuration: Specific devices</a>.
Individual nodes can override the cluster wide specified directories list.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">ceph.rook.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">CephCluster</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-ceph</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-ceph</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">cephVersion</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">ceph/ceph:v13.2.4-20190109</span>
  <span class="na">dataDirHostPath</span><span class="pi">:</span> <span class="s">/var/lib/rook</span>
  <span class="na">network</span><span class="pi">:</span>
    <span class="na">hostNetwork</span><span class="pi">:</span> <span class="no">false</span>
  <span class="na">dashboard</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
  <span class="c1"># cluster level storage configuration and selection</span>
  <span class="na">storage</span><span class="pi">:</span>
    <span class="na">useAllNodes</span><span class="pi">:</span> <span class="no">false</span>
    <span class="na">useAllDevices</span><span class="pi">:</span> <span class="no">false</span>
    <span class="na">config</span><span class="pi">:</span>
      <span class="na">databaseSizeMB</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1024"</span> <span class="c1"># this value can be removed for environments with normal sized disks (100 GB or larger)</span>
      <span class="na">journalSizeMB</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1024"</span>  <span class="c1"># this value can be removed for environments with normal sized disks (20 GB or larger)</span>
    <span class="na">directories</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/rook/storage-dir"</span>
    <span class="na">nodes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">172.17.4.101"</span>
      <span class="na">directories</span><span class="pi">:</span> <span class="c1"># specific directories to use for storage can be specified for each node</span>
      <span class="c1"># overrides the above `directories` values for this node</span>
      <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/rook/my-node-storage-dir"</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">172.17.4.201"</span>
</code></pre></div></div>

<h3 id="node-affinity">Node Affinity</h3>
<p>To control where various services will be scheduled by kubernetes, use the placement configuration sections below.
The example under ‘all’ would have all services scheduled on kubernetes nodes labeled with ‘role=storage’ and
tolerate taints with a key of ‘storage-node’.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">ceph.rook.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">CephCluster</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-ceph</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-ceph</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">cephVersion</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">ceph/ceph:v13.2.4-20190109</span>
  <span class="na">dataDirHostPath</span><span class="pi">:</span> <span class="s">/var/lib/rook</span>
  <span class="na">network</span><span class="pi">:</span>
    <span class="na">hostNetwork</span><span class="pi">:</span> <span class="no">false</span>
  <span class="na">dashboard</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">placement</span><span class="pi">:</span>
    <span class="na">all</span><span class="pi">:</span>
      <span class="na">nodeAffinity</span><span class="pi">:</span>
        <span class="na">requiredDuringSchedulingIgnoredDuringExecution</span><span class="pi">:</span>
          <span class="na">nodeSelectorTerms</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">matchExpressions</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">key</span><span class="pi">:</span> <span class="s">role</span>
              <span class="na">operator</span><span class="pi">:</span> <span class="s">In</span>
              <span class="na">values</span><span class="pi">:</span>
              <span class="pi">-</span> <span class="s">storage-node</span>
      <span class="na">tolerations</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">key</span><span class="pi">:</span> <span class="s">storage-node</span>
        <span class="na">operator</span><span class="pi">:</span> <span class="s">Exists</span>
    <span class="na">mgr</span><span class="pi">:</span>
      <span class="na">nodeAffinity</span><span class="pi">:</span>
      <span class="na">tolerations</span><span class="pi">:</span>
    <span class="na">mon</span><span class="pi">:</span>
      <span class="na">nodeAffinity</span><span class="pi">:</span>
      <span class="na">tolerations</span><span class="pi">:</span>
    <span class="na">osd</span><span class="pi">:</span>
      <span class="na">nodeAffinity</span><span class="pi">:</span>
      <span class="na">tolerations</span><span class="pi">:</span>
</code></pre></div></div>

<h3 id="resource-requestslimits">Resource requests/Limits</h3>
<p>To control how many resources the rook components can request/use, you can set requests and limits in Kubernetes for them.
You can override these requests/limits for OSDs per node when using <code class="language-plaintext highlighter-rouge">useAllNodes: false</code> in the <code class="language-plaintext highlighter-rouge">node</code> item in the <code class="language-plaintext highlighter-rouge">nodes</code> list.</p>

<p><strong>WARNING</strong> Before setting resource requests/limits, please take a look at the Ceph documentation for recommendations for each component: <a href="http://docs.ceph.com/docs/master/start/hardware-recommendations/">Ceph - Hardware Recommendations</a>.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">ceph.rook.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">CephCluster</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-ceph</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-ceph</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">cephVersion</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">ceph/ceph:v13.2.4-20190109</span>
  <span class="na">dataDirHostPath</span><span class="pi">:</span> <span class="s">/var/lib/rook</span>
  <span class="c1"># cluster level resource requests/limits configuration</span>
  <span class="na">resources</span><span class="pi">:</span>
  <span class="na">storage</span><span class="pi">:</span>
    <span class="na">useAllNodes</span><span class="pi">:</span> <span class="no">false</span>
    <span class="na">nodes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">172.17.4.201"</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">limits</span><span class="pi">:</span>
          <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">2"</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">4096Mi"</span>
        <span class="na">requests</span><span class="pi">:</span>
          <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">2"</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">4096Mi"</span>
</code></pre></div></div>

<h2 id="common-cluster-resources">Common Cluster Resources</h2>
<p>Each Ceph cluster must be created in a namespace and also give access to the Rook operator to manage the cluster in the namespace. Creating the namespace and these controls must be added to each of the examples previously shown.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Namespace</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-ceph</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-ceph-osd</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-ceph</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-ceph-mgr</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-ceph</span>
<span class="nn">---</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Role</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1beta1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-ceph-osd</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-ceph</span>
<span class="na">rules</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">"</span><span class="pi">]</span>
  <span class="na">resources</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">configmaps"</span><span class="pi">]</span>
  <span class="na">verbs</span><span class="pi">:</span> <span class="pi">[</span> <span class="s2">"</span><span class="s">get"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">list"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">watch"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">create"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">update"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">delete"</span> <span class="pi">]</span>
<span class="nn">---</span>
<span class="c1"># Aspects of ceph-mgr that require access to the system namespace</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Role</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1beta1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-ceph-mgr-system</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-ceph</span>
<span class="na">rules</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">resources</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">configmaps</span>
  <span class="na">verbs</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">get</span>
  <span class="pi">-</span> <span class="s">list</span>
  <span class="pi">-</span> <span class="s">watch</span>
<span class="nn">---</span>
<span class="c1"># Aspects of ceph-mgr that operate within the cluster's namespace</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Role</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1beta1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-ceph-mgr</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-ceph</span>
<span class="na">rules</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">resources</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">pods</span>
  <span class="pi">-</span> <span class="s">services</span>
  <span class="na">verbs</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">get</span>
  <span class="pi">-</span> <span class="s">list</span>
  <span class="pi">-</span> <span class="s">watch</span>
<span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">batch</span>
  <span class="na">resources</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">jobs</span>
  <span class="na">verbs</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">get</span>
  <span class="pi">-</span> <span class="s">list</span>
  <span class="pi">-</span> <span class="s">watch</span>
  <span class="pi">-</span> <span class="s">create</span>
  <span class="pi">-</span> <span class="s">update</span>
  <span class="pi">-</span> <span class="s">delete</span>
<span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">ceph.rook.io</span>
  <span class="na">resources</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">*"</span>
  <span class="na">verbs</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">*"</span>
<span class="nn">---</span>
<span class="c1"># Allow the operator to create resources in this cluster's namespace</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">RoleBinding</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1beta1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-ceph-cluster-mgmt</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-ceph</span>
<span class="na">roleRef</span><span class="pi">:</span>
  <span class="na">apiGroup</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRole</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-ceph-cluster-mgmt</span>
<span class="na">subjects</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-ceph-system</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-ceph-system</span>
<span class="nn">---</span>
<span class="c1"># Allow the osd pods in this namespace to work with configmaps</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">RoleBinding</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1beta1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-ceph-osd</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-ceph</span>
<span class="na">roleRef</span><span class="pi">:</span>
  <span class="na">apiGroup</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">Role</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-ceph-osd</span>
<span class="na">subjects</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-ceph-osd</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-ceph</span>
<span class="nn">---</span>
<span class="c1"># Allow the ceph mgr to access the cluster-specific resources necessary for the mgr modules</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">RoleBinding</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1beta1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-ceph-mgr</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-ceph</span>
<span class="na">roleRef</span><span class="pi">:</span>
  <span class="na">apiGroup</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">Role</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-ceph-mgr</span>
<span class="na">subjects</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-ceph-mgr</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-ceph</span>
<span class="nn">---</span>
<span class="c1"># Allow the ceph mgr to access the rook system resources necessary for the mgr modules</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">RoleBinding</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1beta1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-ceph-mgr-system</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-ceph-system</span>
<span class="na">roleRef</span><span class="pi">:</span>
  <span class="na">apiGroup</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">Role</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-ceph-mgr-system</span>
<span class="na">subjects</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-ceph-mgr</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-ceph</span>
<span class="nn">---</span>
<span class="c1"># Allow the ceph mgr to access cluster-wide resources necessary for the mgr modules</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">RoleBinding</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1beta1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-ceph-mgr-cluster</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-ceph</span>
<span class="na">roleRef</span><span class="pi">:</span>
  <span class="na">apiGroup</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRole</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-ceph-mgr-cluster</span>
<span class="na">subjects</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-ceph-mgr</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-ceph</span>
</code></pre></div></div>

    </div>
  </div>
</div>

<script>
  var menu = [];
  var BASE_PATH = "";

  function add(name, url, isChild, current) {
    var item = { name: name, url: url, current: current };
    var container = menu;
    if (isChild && menu.length > 0) {
      menu[menu.length-1].children = menu[menu.length-1].children || [];
      container = menu[menu.length-1].children;
      if (current) {
        menu[menu.length-1].childCurrent = true;
      }
    }
    container.push(item);
  }

  
    add(
      "Rook",
      "/docs/rook/v0.9/",
      false,
      false
    );
  
    add(
      "Quickstart",
      "/docs/rook/v0.9/quickstart-toc.html",
      false,
      false
    );
  
    add(
      "Ceph Storage",
      "/docs/rook/v0.9/ceph-quickstart.html",
      true,
      false
    );
  
    add(
      "CockroachDB",
      "/docs/rook/v0.9/cockroachdb.html",
      true,
      false
    );
  
    add(
      "Minio Object Store",
      "/docs/rook/v0.9/minio-object-store.html",
      true,
      false
    );
  
    add(
      "EdgeFS Geo-Transparent Storage",
      "/docs/rook/v0.9/edgefs-quickstart.html",
      true,
      false
    );
  
    add(
      "Cassandra",
      "/docs/rook/v0.9/cassandra.html",
      true,
      false
    );
  
    add(
      "Network File System (NFS)",
      "/docs/rook/v0.9/nfs.html",
      true,
      false
    );
  
    add(
      "Custom Resources",
      "/docs/rook/v0.9/crds.html",
      true,
      false
    );
  
    add(
      "Prerequisites",
      "/docs/rook/v0.9/k8s-pre-reqs.html",
      false,
      false
    );
  
    add(
      "FlexVolume Configuration",
      "/docs/rook/v0.9/flexvolume.html",
      true,
      false
    );
  
    add(
      "RBAC Security",
      "/docs/rook/v0.9/rbac.html",
      true,
      false
    );
  
    add(
      "Tectonic Bare Metal",
      "/docs/rook/v0.9/tectonic.html",
      true,
      false
    );
  
    add(
      "OpenShift",
      "/docs/rook/v0.9/openshift.html",
      true,
      false
    );
  
    add(
      "Ceph Storage",
      "/docs/rook/v0.9/ceph-storage.html",
      false,
      false
    );
  
    add(
      "Block Storage",
      "/docs/rook/v0.9/ceph-block.html",
      true,
      false
    );
  
    add(
      "Object Storage",
      "/docs/rook/v0.9/ceph-object.html",
      true,
      false
    );
  
    add(
      "Shared File System",
      "/docs/rook/v0.9/ceph-filesystem.html",
      true,
      false
    );
  
    add(
      "Dashboard",
      "/docs/rook/v0.9/ceph-dashboard.html",
      true,
      false
    );
  
    add(
      "Monitoring",
      "/docs/rook/v0.9/ceph-monitoring.html",
      true,
      false
    );
  
    add(
      "Cluster CRD",
      "/docs/rook/v0.9/ceph-cluster-crd.html",
      true,
      true
    );
  
    add(
      "Block Pool CRD",
      "/docs/rook/v0.9/ceph-pool-crd.html",
      true,
      false
    );
  
    add(
      "Object Store CRD",
      "/docs/rook/v0.9/ceph-object-store-crd.html",
      true,
      false
    );
  
    add(
      "Object Store User CRD",
      "/docs/rook/v0.9/ceph-object-store-user-crd.html",
      true,
      false
    );
  
    add(
      "Shared File System CRD",
      "/docs/rook/v0.9/ceph-filesystem-crd.html",
      true,
      false
    );
  
    add(
      "Upgrades",
      "/docs/rook/v0.9/ceph-upgrade.html",
      true,
      false
    );
  
    add(
      "Cleanup",
      "/docs/rook/v0.9/ceph-teardown.html",
      true,
      false
    );
  
    add(
      "EdgeFS Storage",
      "/docs/rook/v0.9/edgefs-storage.html",
      false,
      false
    );
  
    add(
      "EdgeFS Cluster CRD",
      "/docs/rook/v0.9/edgefs-cluster-crd.html",
      true,
      false
    );
  
    add(
      "EdgeFS Scale-Out NFS CRD",
      "/docs/rook/v0.9/edgefs-nfs-crd.html",
      true,
      false
    );
  
    add(
      "Edge-X S3 CRD",
      "/docs/rook/v0.9/edgefs-s3x-crd.html",
      true,
      false
    );
  
    add(
      "EdgeFS AWS S3 CRD",
      "/docs/rook/v0.9/edgefs-s3-crd.html",
      true,
      false
    );
  
    add(
      "EdgeFS iSCSI Target CRD",
      "/docs/rook/v0.9/edgefs-iscsi-crd.html",
      true,
      false
    );
  
    add(
      "EdgeFS CSI provisioner",
      "/docs/rook/v0.9/edgefs-csi.html",
      true,
      false
    );
  
    add(
      "Cassandra Cluster CRD",
      "/docs/rook/v0.9/cassandra-cluster-crd.html",
      false,
      false
    );
  
    add(
      "Cassandra Operator Upgrade",
      "/docs/rook/v0.9/cassandra-operator-upgrade.html",
      false,
      false
    );
  
    add(
      "CockroachDB Cluster CRD",
      "/docs/rook/v0.9/cockroachdb-cluster-crd.html",
      false,
      false
    );
  
    add(
      "Minio Object Store CRD",
      "/docs/rook/v0.9/minio-object-store-crd.html",
      false,
      false
    );
  
    add(
      "NFS Server CRD",
      "/docs/rook/v0.9/nfs-crd.html",
      false,
      false
    );
  
    add(
      "Helm Charts",
      "/docs/rook/v0.9/helm.html",
      false,
      false
    );
  
    add(
      "Ceph Operator",
      "/docs/rook/v0.9/helm-operator.html",
      true,
      false
    );
  
    add(
      "Ceph Tools",
      "/docs/rook/v0.9/ceph-tools.html",
      false,
      false
    );
  
    add(
      "Toolbox",
      "/docs/rook/v0.9/ceph-toolbox.html",
      true,
      false
    );
  
    add(
      "Direct Tools",
      "/docs/rook/v0.9/direct-tools.html",
      true,
      false
    );
  
    add(
      "Advanced Configuration",
      "/docs/rook/v0.9/advanced-configuration.html",
      true,
      false
    );
  
    add(
      "Common Issues",
      "/docs/rook/v0.9/common-issues.html",
      true,
      false
    );
  
    add(
      "Container Linux",
      "/docs/rook/v0.9/container-linux.html",
      true,
      false
    );
  
    add(
      "Disaster Recovery",
      "/docs/rook/v0.9/disaster-recovery.html",
      true,
      false
    );
  
    add(
      "Contributing",
      "/docs/rook/v0.9/development-flow.html",
      false,
      false
    );
  
    add(
      "Multi-Node Test Environment",
      "/docs/rook/v0.9/development-environment.html",
      true,
      false
    );
  

  function getEntry(item) {
    var itemDom = document.createElement('li');

    if (item.current) {
      itemDom.innerHTML = item.name;
      itemDom.classList.add('current');
    } else {
      itemDom.innerHTML = '<a href="' + item.url + '">' + item.name + '</a>';
    }

    return itemDom;
  }

  // Flush css changes as explained in: https://stackoverflow.com/a/34726346
  // and more completely: https://stackoverflow.com/a/6956049
  function flushCss(element) {
    element.offsetHeight;
  }

  function addArrow(itemDom) {
    var MAIN_ITEM_HEIGHT = 24;
    var BOTTOM_PADDING = 20;
    var arrowDom = document.createElement('a');
    arrowDom.classList.add('arrow');
    arrowDom.innerHTML = '<img src="' + BASE_PATH + '/images/arrow.svg" />';
    arrowDom.onclick = function(itemDom) {
      return function () {
        // Calculated full height of the opened list
        var fullHeight = MAIN_ITEM_HEIGHT + BOTTOM_PADDING + itemDom.lastChild.clientHeight + 'px';

        itemDom.classList.toggle('open');

        if (itemDom.classList.contains('open')) {
          itemDom.style.height = fullHeight;
        } else {
          // If the list height is auto we have to set it to fullHeight
          // without tranistion before we shrink it to collapsed height
          if (itemDom.style.height === 'auto') {
            itemDom.style.transition = 'none';
            itemDom.style.height = fullHeight;
            flushCss(itemDom);
            itemDom.style.transition = '';
          }
          itemDom.style.height = MAIN_ITEM_HEIGHT + 'px';
        }

        return false;
      };
    }(itemDom);
    itemDom.appendChild(arrowDom);

    if ((item.current && item.children) || item.childCurrent) {
      itemDom.classList.add('open');
      itemDom.style.height = 'auto';
    } else {
      itemDom.style.height = MAIN_ITEM_HEIGHT + 'px';
    }
  }

  var menuDom = document.getElementById('docs-ul');
  for (var i = 0; i < menu.length; i++) {
    var item = menu[i];
    var itemDom = getEntry(item);

    if (item.childCurrent) {
      itemDom.classList.add('childCurrent');
    }

    if (item.children) {
      addArrow(itemDom);
      itemDom.classList.add('children');
      var children = document.createElement('ul');
      for (var j = 0; j < item.children.length; j++) {
        children.appendChild(getEntry(item.children[j]));
      }
      itemDom.appendChild(children);
    }
    menuDom.appendChild(itemDom);
  }
</script>
</div></main>
    <footer id="footer" aria-label="Footer">
  <div class="top">
    <a href="//www.cncf.io">
      <img
        class="cncf"
        src="/images/cncf.png"
        srcset="/images/cncf@2x.png 2x, /images/cncf@3x.png 3x" />
    </a>
    <p>We are a Cloud Native Computing Foundation graduated project.</p>
  </div>
  <div class="middle">
    <div class="grid-center">
      <div class="col_sm-12">
        <span>Getting Started</span>
        <a href="//github.com/rook/rook">GitHub</a>
        <a href="/docs/rook/v1.9/">Documentation</a>
        <a href="//github.com/rook/rook/blob/master/CONTRIBUTING.md#how-to-contribute">How to Contribute</a>
      </div>
      <div class="col_sm-12">
        <span>Community</span>
        <a href="//slack.rook.io/">Slack</a>
        <a href="//twitter.com/rook_io">Twitter</a>
        <a href="//groups.google.com/forum/#!forum/rook-dev">Forum</a>
        <a href="//blog.rook.io/">Blog</a>
      </div>
      <div class="col_sm-12">
        <span>Contact</span>
        <a href="mailto:cncf-rook-info@lists.cncf.io">Email</a>
        <a href="//github.com/rook/rook/issues">Feature request</a>
      </div>
      <div class="col_sm-12">
        <span>Top Contributors</span>
        <a href="//cloudical.io/">Cloudical</a>
        <a href="//cybozu.com">Cybozu, Inc</a>
        <a href="//www.redhat.com">Red Hat</a>
        <a href="//www.suse.com/">SUSE</a>
        <a href="//upbound.io">Upbound</a>
      </div>
    </div>
  </div>
  <div class="bottom">
    <div class="grid-center">
      <div class="col-8">
        <a class="logo" href="/">
          <img src="/images/rook-logo-small.svg" alt="rook.io" />
        </a>
        <p>
          &#169; Rook Authors 2022. Documentation distributed under
          <a href="https://creativecommons.org/licenses/by/4.0">CC-BY-4.0</a>.
        </p>
        <p>
          &#169; 2022 The Linux Foundation. All rights reserved. The Linux Foundation has
          registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our
          <a href="https://www.linuxfoundation.org/trademark-usage/">Trademark Usage</a> page.
        </p>
      </div>
    </div>
  </div>
</footer>


  <script src="/js/anchor.js"></script>
  <script>
    anchors.options = {
      placement: 'right',
      icon: '#',
    }

    document.addEventListener('DOMContentLoaded', function(event) {
      anchors.add('.docs-text h1, .docs-text h2, .docs-text h3, .docs-text h4, .docs-text h5, .docs-text h6');
    });
  </script>




    
  </body>
</html>
