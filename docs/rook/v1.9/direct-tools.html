












































<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />

    

    <title>Ceph Docs</title>

    <link rel="canonical" href="https://rook.io/docs/rook/v1.9/direct-tools.html">

    <link rel="icon" href="/favicon.ico" />
<link rel="icon" type="image/png" href="/images/favicon_16x16.png" sizes="16x16" />
<link rel="icon" type="image/png" href="/images/favicon_32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="/images/favicon_48x48.png" sizes="48x48" />
<link rel="icon" type="image/png" href="/images/favicon_192x192.png" sizes="192x192" />


    <link href="//fonts.googleapis.com/css?family=Montserrat:500|Open+Sans:300,400,600" rel="stylesheet">
    
    <link rel="stylesheet" href="/css/main.css">
    
      <link rel="stylesheet" href="/css/docs.css" />
    
  </head>
  <body>
    <nav id="navigation" aria-label="Navigation">
  <div>
    <div class="logo">
      <a href="/"><img src="/images/rook-logo.svg"/></a>
    </div>
    <div
      class="hamburger-controls"
      onclick="if (document.body.classList.contains('menu-open')) { document.body.classList.remove('menu-open') } else { document.body.classList.add('menu-open') }; return false;">
      <span></span> <span></span> <span></span>
    </div>
    <ul class="links">
      <li class="dropdown">
        <a role="button" href="javascript:void(0)">Documentation</a>
        <div class="dropdown-content">
          <a href="/docs/rook/v1.9/">Ceph</a>
          <a href="/docs/cassandra/v1.7/">Cassandra</a>
          <a href="/docs/nfs/v1.7/">NFS</a>
        </div>
      <li class="dropdown">
        <a role="button" href="javascript:void(0)">Community</a>
        <div class="dropdown-content">
          <a href="//github.com/rook/rook">GitHub</a>
          <a href="//slack.rook.io/">Slack</a>
          <a href="//groups.google.com/forum/#!forum/rook-dev">Forum</a>
          <a href="//twitter.com/rook_io">Twitter</a>
        </div>
      </li>
      <li><a href="//blog.rook.io/">Blog</a></li>
      <li><a class="button small" href="/docs/rook/v1.9/quickstart.html">Get Started</a></li>
    </ul>
  </div>
</nav>

    <main id="content" aria-label="Content"><div>



















<section class="docs-header">
  <h1>Ceph</h1>
  <div class="versions">
    <a role="button" href="javascript:void(0)">Rook Ceph v1.9</a>
    <div class="versions-dropdown-content">
      
        <a href="/docs/rook/v1.9/direct-tools.html" class="active">Rook Ceph v1.9</a>
      
        <a href="/docs/rook/v1.8/direct-tools.html">Rook Ceph v1.8</a>
      
        <a href="/docs/rook/v1.7/direct-tools.html">Rook Ceph v1.7</a>
      
        <a href="/docs/rook/v1.6/direct-tools.html">Rook Ceph v1.6</a>
      
        <a href="/docs/rook/v1.5/direct-tools.html">Rook Ceph v1.5</a>
      
        <a href="/docs/rook/v1.4/direct-tools.html">Rook Ceph v1.4</a>
      
        <a href="/docs/rook/v1.3/direct-tools.html">Rook Ceph v1.3</a>
      
        <a href="/docs/rook/v1.2/direct-tools.html">Rook Ceph v1.2</a>
      
        <a href="/docs/rook/v1.1/direct-tools.html">Rook Ceph v1.1</a>
      
        <a href="/docs/rook/v1.0/direct-tools.html">Rook Ceph v1.0</a>
      
        <a href="/docs/rook/v0.9/direct-tools.html">Rook Ceph v0.9</a>
      
        <a href="/docs/rook/v0.8/direct-tools.html">Rook Ceph v0.8</a>
      
        <a href="/docs/rook/v0.7/direct-tools.html">Rook Ceph v0.7</a>
      
        <a href="/docs/rook/v0.6/direct-tools.html">Rook Ceph v0.6</a>
      
        <a href="/docs/rook/v0.5/direct-tools.html">Rook Ceph v0.5</a>
      
        <a href="/docs/rook/latest/direct-tools.html">Rook Ceph latest</a>
      
    </div>
    <img src="/images/arrow.svg" />
  </div>
</section>
<div class="page">
  <div class="docs-menu">
      <ul id="docs-ul"></ul>
  </div>
  <div class="docs-content">
    <div class="docs-actions">
      <a id="edit" href="https://github.com/rook/rook/blob/master/Documentation/direct-tools.md">Edit on GitHub</a>
    </div>
    
    <div class="docs-text">
      <h1 id="direct-tools">Direct Tools</h1>

<p>Rook is designed with Kubernetes design principles from the ground up. This topic is going to escape the bounds of Kubernetes storage and show you how to
use block and file storage directly from a pod without any of the Kubernetes magic. The purpose of this topic is to help you quickly test a new configuration,
although it is not meant to be used in production. All of the benefits of Kubernetes storage including failover, detach, and attach will not be available.
If your pod dies, your mount will die with it.</p>

<h2 id="start-the-direct-mount-pod">Start the Direct Mount Pod</h2>

<p>To test mounting your Ceph volumes, start a pod with the necessary mounts. An example is provided in the examples test directory:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl create -f deploy/examples/direct-mount.yaml
</span></code></pre></div></div>

<p>After the pod is started, connect to it like this:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl -n rook-ceph get pod -l app=rook-direct-mount
</span><span class="gp">$</span><span class="w"> </span>kubectl <span class="nt">-n</span> rook-ceph <span class="nb">exec</span> <span class="nt">-it</span> &lt;pod&gt; bash
</code></pre></div></div>

<h2 id="block-storage-tools">Block Storage Tools</h2>

<p>After you have created a pool as described in the <a href="/docs/rook/v1.9/ceph-block.html">Block Storage</a> topic, you can create a block image and mount it directly in a pod.
This example will show how the Ceph rbd volume can be mounted in the direct mount pod.</p>

<p>Create the <a href="/docs/rook/v1.9/direct-tools.html#Start-the-Direct-Mount-Pod">Direct Mount Pod</a>.</p>

<p>Create a volume image (10MB):</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">rbd create replicapool/test --size 10
rbd info replicapool/test

</span><span class="gp">#</span><span class="w"> </span>Disable the rbd features that are not <span class="k">in </span>the kernel module
<span class="go">rbd feature disable replicapool/test fast-diff deep-flatten object-map
</span></code></pre></div></div>

<p>Map the block volume and format it and mount it:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span><span class="w"> </span>Map the rbd device. If the Direct Mount Pod was started with <span class="s2">"hostNetwork: false"</span> this hangs and you have to stop it with Ctrl-C,
<span class="gp">#</span><span class="w"> </span>however the <span class="nb">command </span>still succeeds<span class="p">;</span> see https://github.com/rook/rook/issues/2021
<span class="go">rbd map replicapool/test

</span><span class="gp">#</span><span class="w"> </span>Find the device name, such as rbd0
<span class="go">lsblk | grep rbd

</span><span class="gp">#</span><span class="w"> </span>Format the volume <span class="o">(</span>only <span class="k">do </span>this the first <span class="nb">time </span>or you will lose data<span class="o">)</span>
<span class="go">mkfs.ext4 -m0 /dev/rbd0

</span><span class="gp">#</span><span class="w"> </span>Mount the block device
<span class="go">mkdir /tmp/rook-volume
mount /dev/rbd0 /tmp/rook-volume
</span></code></pre></div></div>

<p>Write and read a file:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">echo "Hello Rook" &gt;</span><span class="w"> </span>/tmp/rook-volume/hello
<span class="go">cat /tmp/rook-volume/hello
</span></code></pre></div></div>

<h3 id="unmount-the-block-device">Unmount the Block device</h3>

<p>Unmount the volume and unmap the kernel device:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">umount /tmp/rook-volume
rbd unmap /dev/rbd0
</span></code></pre></div></div>

<h2 id="shared-filesystem-tools">Shared Filesystem Tools</h2>

<p>After you have created a filesystem as described in the <a href="/docs/rook/v1.9/ceph-filesystem.html">Shared Filesystem</a> topic, you can mount the filesystem from multiple pods.
The the other topic you may have mounted the filesystem already in the registry pod. Now we will mount the same filesystem in the Direct Mount pod.
This is just a simple way to validate the Ceph filesystem and is not recommended for production Kubernetes pods.</p>

<p>Follow <a href="/docs/rook/v1.9/direct-tools.html#Start-the-Direct-Mount-Pod">Direct Mount Pod</a> to start a pod with the necessary mounts and then proceed with the following commands after connecting to the pod.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span><span class="w"> </span>Create the directory
<span class="go">mkdir /tmp/registry

</span><span class="gp">#</span><span class="w"> </span>Detect the mon endpoints and the user secret <span class="k">for </span>the connection
<span class="gp">mon_endpoints=$</span><span class="o">(</span><span class="nb">grep </span>mon_host /etc/ceph/ceph.conf | <span class="nb">awk</span> <span class="s1">'{print $3}'</span><span class="o">)</span>
<span class="gp">my_secret=$</span><span class="o">(</span><span class="nb">grep </span>key /etc/ceph/keyring | <span class="nb">awk</span> <span class="s1">'{print $3}'</span><span class="o">)</span>
<span class="go">
</span><span class="gp">#</span><span class="w"> </span>Mount the filesystem
<span class="gp">mount -t ceph -o mds_namespace=myfs,name=admin,secret=$</span>my_secret <span class="nv">$mon_endpoints</span>:/ /tmp/registry
<span class="go">
</span><span class="gp">#</span><span class="w"> </span>See your mounted filesystem
<span class="go">df -h
</span></code></pre></div></div>

<p>Now you should have a mounted filesystem. If you have pushed images to the registry you will see a directory called <code class="language-plaintext highlighter-rouge">docker</code>.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">ls /tmp/registry
</span></code></pre></div></div>

<p>Try writing and reading a file to the shared filesystem.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">echo "Hello Rook" &gt;</span><span class="w"> </span>/tmp/registry/hello
<span class="go">cat /tmp/registry/hello

</span><span class="gp">#</span><span class="w"> </span>delete the file when you<span class="s1">'re done
</span><span class="go">rm -f /tmp/registry/hello
</span></code></pre></div></div>

<h3 id="unmount-the-filesystem">Unmount the Filesystem</h3>

<p>To unmount the shared filesystem from the Direct Mount Pod:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">umount /tmp/registry
rmdir /tmp/registry
</span></code></pre></div></div>

<p>No data will be deleted by unmounting the filesystem.</p>

    </div>
  </div>
</div>

<script>
  var menu = [];
  var BASE_PATH = "";

  function add(name, url, isChild, current) {
    var item = { name: name, url: url, current: current };
    var container = menu;
    if (isChild && menu.length > 0) {
      menu[menu.length-1].children = menu[menu.length-1].children || [];
      container = menu[menu.length-1].children;
      if (current) {
        menu[menu.length-1].childCurrent = true;
      }
    }
    container.push(item);
  }

  
    add(
      "Rook",
      "/docs/rook/v1.9/",
      false,
      false
    );
  
    add(
      "Quickstart",
      "/docs/rook/v1.9/quickstart.html",
      false,
      false
    );
  
    add(
      "Prerequisites",
      "/docs/rook/v1.9/pre-reqs.html",
      false,
      false
    );
  
    add(
      "Authenticated Registries",
      "/docs/rook/v1.9/authenticated-registry.html",
      true,
      false
    );
  
    add(
      "Pod Security Policies",
      "/docs/rook/v1.9/pod-security-policies.html",
      true,
      false
    );
  
    add(
      "Ceph Storage",
      "/docs/rook/v1.9/ceph-storage.html",
      false,
      false
    );
  
    add(
      "Examples",
      "/docs/rook/v1.9/ceph-examples.html",
      true,
      false
    );
  
    add(
      "OpenShift",
      "/docs/rook/v1.9/ceph-openshift.html",
      true,
      false
    );
  
    add(
      "Block Storage",
      "/docs/rook/v1.9/ceph-block.html",
      true,
      false
    );
  
    add(
      "Object Storage",
      "/docs/rook/v1.9/ceph-object.html",
      true,
      false
    );
  
    add(
      "Object Multisite",
      "/docs/rook/v1.9/ceph-object-multisite.html",
      true,
      false
    );
  
    add(
      "Shared Filesystem",
      "/docs/rook/v1.9/ceph-filesystem.html",
      true,
      false
    );
  
    add(
      "Ceph Dashboard",
      "/docs/rook/v1.9/ceph-dashboard.html",
      true,
      false
    );
  
    add(
      "Prometheus Monitoring",
      "/docs/rook/v1.9/ceph-monitoring.html",
      true,
      false
    );
  
    add(
      "Cluster CRD",
      "/docs/rook/v1.9/ceph-cluster-crd.html",
      true,
      false
    );
  
    add(
      "Block Pool CRD",
      "/docs/rook/v1.9/ceph-pool-crd.html",
      true,
      false
    );
  
    add(
      "Object Store CRD",
      "/docs/rook/v1.9/ceph-object-store-crd.html",
      true,
      false
    );
  
    add(
      "Object Multisite CRDs",
      "/docs/rook/v1.9/ceph-object-multisite-crd.html",
      true,
      false
    );
  
    add(
      "Object Bucket Claim",
      "/docs/rook/v1.9/ceph-object-bucket-claim.html",
      true,
      false
    );
  
    add(
      "Object Store User CRD",
      "/docs/rook/v1.9/ceph-object-store-user-crd.html",
      true,
      false
    );
  
    add(
      "Bucket Notifications",
      "/docs/rook/v1.9/ceph-object-bucket-notifications.html",
      true,
      false
    );
  
    add(
      "Shared Filesystem CRD",
      "/docs/rook/v1.9/ceph-filesystem-crd.html",
      true,
      false
    );
  
    add(
      "NFS CRD",
      "/docs/rook/v1.9/ceph-nfs-crd.html",
      true,
      false
    );
  
    add(
      "Ceph CSI",
      "/docs/rook/v1.9/ceph-csi-drivers.html",
      true,
      false
    );
  
    add(
      "RBD Mirroring",
      "/docs/rook/v1.9/rbd-mirroring.html",
      true,
      false
    );
  
    add(
      "Failover and Failback",
      "/docs/rook/v1.9/async-disaster-recovery.html",
      true,
      false
    );
  
    add(
      "Snapshots",
      "/docs/rook/v1.9/ceph-csi-snapshot.html",
      true,
      false
    );
  
    add(
      "Volume clone",
      "/docs/rook/v1.9/ceph-csi-volume-clone.html",
      true,
      false
    );
  
    add(
      "Client CRD",
      "/docs/rook/v1.9/ceph-client-crd.html",
      true,
      false
    );
  
    add(
      "RBD Mirror CRD",
      "/docs/rook/v1.9/ceph-rbd-mirror-crd.html",
      true,
      false
    );
  
    add(
      "Filesystem Mirror CRD",
      "/docs/rook/v1.9/ceph-fs-mirror-crd.html",
      true,
      false
    );
  
    add(
      "SubVolume Group CRD",
      "/docs/rook/v1.9/ceph-fs-subvolumegroup.html",
      true,
      false
    );
  
    add(
      "RADOS Namespace CRD",
      "/docs/rook/v1.9/ceph-pool-radosnamespace.html",
      true,
      false
    );
  
    add(
      "Key Management System",
      "/docs/rook/v1.9/ceph-kms.html",
      true,
      false
    );
  
    add(
      "Configuration",
      "/docs/rook/v1.9/ceph-configuration.html",
      true,
      false
    );
  
    add(
      "Upgrades",
      "/docs/rook/v1.9/ceph-upgrade.html",
      true,
      false
    );
  
    add(
      "Cleanup",
      "/docs/rook/v1.9/ceph-teardown.html",
      true,
      false
    );
  
    add(
      "Helm Charts",
      "/docs/rook/v1.9/helm.html",
      false,
      false
    );
  
    add(
      "Ceph Operator",
      "/docs/rook/v1.9/helm-operator.html",
      true,
      false
    );
  
    add(
      "Ceph Cluster",
      "/docs/rook/v1.9/helm-ceph-cluster.html",
      true,
      false
    );
  
    add(
      "Common Issues",
      "/docs/rook/v1.9/common-issues.html",
      false,
      false
    );
  
    add(
      "Ceph Tools",
      "/docs/rook/v1.9/ceph-tools.html",
      false,
      false
    );
  
    add(
      "Toolbox",
      "/docs/rook/v1.9/ceph-toolbox.html",
      true,
      false
    );
  
    add(
      "Common Issues",
      "/docs/rook/v1.9/ceph-common-issues.html",
      true,
      false
    );
  
    add(
      "CSI Common Issues",
      "/docs/rook/v1.9/ceph-csi-troubleshooting.html",
      true,
      false
    );
  
    add(
      "Monitor Health",
      "/docs/rook/v1.9/ceph-mon-health.html",
      true,
      false
    );
  
    add(
      "OSD Management",
      "/docs/rook/v1.9/ceph-osd-mgmt.html",
      true,
      false
    );
  
    add(
      "Direct Tools",
      "/docs/rook/v1.9/direct-tools.html",
      true,
      true
    );
  
    add(
      "Advanced Configuration",
      "/docs/rook/v1.9/ceph-advanced-configuration.html",
      true,
      false
    );
  
    add(
      "OpenShift Common Issues",
      "/docs/rook/v1.9/ceph-openshift-issues.html",
      true,
      false
    );
  
    add(
      "Disaster Recovery",
      "/docs/rook/v1.9/ceph-disaster-recovery.html",
      true,
      false
    );
  
    add(
      "Contributing",
      "/docs/rook/v1.9/development-flow.html",
      false,
      false
    );
  
    add(
      "Developer Environment",
      "/docs/rook/v1.9/development-environment.html",
      true,
      false
    );
  
    add(
      "Storage Providers",
      "/docs/rook/v1.9/storage-providers.html",
      true,
      false
    );
  

  function getEntry(item) {
    var itemDom = document.createElement('li');

    if (item.current) {
      itemDom.innerHTML = item.name;
      itemDom.classList.add('current');
    } else {
      itemDom.innerHTML = '<a href="' + item.url + '">' + item.name + '</a>';
    }

    return itemDom;
  }

  // Flush css changes as explained in: https://stackoverflow.com/a/34726346
  // and more completely: https://stackoverflow.com/a/6956049
  function flushCss(element) {
    element.offsetHeight;
  }

  function addArrow(itemDom) {
    var MAIN_ITEM_HEIGHT = 24;
    var BOTTOM_PADDING = 20;
    var arrowDom = document.createElement('a');
    arrowDom.classList.add('arrow');
    arrowDom.innerHTML = '<img src="' + BASE_PATH + '/images/arrow.svg" />';
    arrowDom.onclick = function(itemDom) {
      return function () {
        // Calculated full height of the opened list
        var fullHeight = MAIN_ITEM_HEIGHT + BOTTOM_PADDING + itemDom.lastChild.clientHeight + 'px';

        itemDom.classList.toggle('open');

        if (itemDom.classList.contains('open')) {
          itemDom.style.height = fullHeight;
        } else {
          // If the list height is auto we have to set it to fullHeight
          // without tranistion before we shrink it to collapsed height
          if (itemDom.style.height === 'auto') {
            itemDom.style.transition = 'none';
            itemDom.style.height = fullHeight;
            flushCss(itemDom);
            itemDom.style.transition = '';
          }
          itemDom.style.height = MAIN_ITEM_HEIGHT + 'px';
        }

        return false;
      };
    }(itemDom);
    itemDom.appendChild(arrowDom);

    if ((item.current && item.children) || item.childCurrent) {
      itemDom.classList.add('open');
      itemDom.style.height = 'auto';
    } else {
      itemDom.style.height = MAIN_ITEM_HEIGHT + 'px';
    }
  }

  var menuDom = document.getElementById('docs-ul');
  for (var i = 0; i < menu.length; i++) {
    var item = menu[i];
    var itemDom = getEntry(item);

    if (item.childCurrent) {
      itemDom.classList.add('childCurrent');
    }

    if (item.children) {
      addArrow(itemDom);
      itemDom.classList.add('children');
      var children = document.createElement('ul');
      for (var j = 0; j < item.children.length; j++) {
        children.appendChild(getEntry(item.children[j]));
      }
      itemDom.appendChild(children);
    }
    menuDom.appendChild(itemDom);
  }
</script>
</div></main>
    <footer id="footer" aria-label="Footer">
  <div class="top">
    <a href="//www.cncf.io">
      <img
        class="cncf"
        src="/images/cncf.png"
        srcset="/images/cncf@2x.png 2x, /images/cncf@3x.png 3x" />
    </a>
    <p>We are a Cloud Native Computing Foundation graduated project.</p>
  </div>
  <div class="middle">
    <div class="grid-center">
      <div class="col_sm-12">
        <span>Getting Started</span>
        <a href="//github.com/rook/rook">GitHub</a>
        <a href="/docs/rook/v1.9/">Documentation</a>
        <a href="//github.com/rook/rook/blob/master/CONTRIBUTING.md#how-to-contribute">How to Contribute</a>
      </div>
      <div class="col_sm-12">
        <span>Community</span>
        <a href="//slack.rook.io/">Slack</a>
        <a href="//twitter.com/rook_io">Twitter</a>
        <a href="//groups.google.com/forum/#!forum/rook-dev">Forum</a>
        <a href="//blog.rook.io/">Blog</a>
      </div>
      <div class="col_sm-12">
        <span>Contact</span>
        <a href="mailto:cncf-rook-info@lists.cncf.io">Email</a>
        <a href="//github.com/rook/rook/issues">Feature request</a>
      </div>
      <div class="col_sm-12">
        <span>Top Contributors</span>
        <a href="//cloudical.io/">Cloudical</a>
        <a href="//cybozu.com">Cybozu, Inc</a>
        <a href="//www.redhat.com">Red Hat</a>
        <a href="//www.suse.com/">SUSE</a>
        <a href="//upbound.io">Upbound</a>
      </div>
    </div>
  </div>
  <div class="bottom">
    <div class="grid-center">
      <div class="col-8">
        <a class="logo" href="/">
          <img src="/images/rook-logo-small.svg" alt="rook.io" />
        </a>
        <p>
          &#169; Rook Authors 2022. Documentation distributed under
          <a href="https://creativecommons.org/licenses/by/4.0">CC-BY-4.0</a>.
        </p>
        <p>
          &#169; 2022 The Linux Foundation. All rights reserved. The Linux Foundation has
          registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our
          <a href="https://www.linuxfoundation.org/trademark-usage/">Trademark Usage</a> page.
        </p>
      </div>
    </div>
  </div>
</footer>


  <script src="/js/anchor.js"></script>
  <script>
    anchors.options = {
      placement: 'right',
      icon: '#',
    }

    document.addEventListener('DOMContentLoaded', function(event) {
      anchors.add('.docs-text h1, .docs-text h2, .docs-text h3, .docs-text h4, .docs-text h5, .docs-text h6');
    });
  </script>




    
  </body>
</html>
