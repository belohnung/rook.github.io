












































<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />

    
    <meta name="robots" content="noindex">
    

    <title>Ceph Docs</title>

    <link rel="canonical" href="https://rook.io/docs/rook/v0.7/monitoring.html">

    <link rel="icon" href="/favicon.ico" />
<link rel="icon" type="image/png" href="/images/favicon_16x16.png" sizes="16x16" />
<link rel="icon" type="image/png" href="/images/favicon_32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="/images/favicon_48x48.png" sizes="48x48" />
<link rel="icon" type="image/png" href="/images/favicon_192x192.png" sizes="192x192" />


    <link href="//fonts.googleapis.com/css?family=Montserrat:500|Open+Sans:300,400,600" rel="stylesheet">
    
    <link rel="stylesheet" href="/css/main.css">
    
      <link rel="stylesheet" href="/css/docs.css" />
    
  </head>
  <body>
    <nav id="navigation" aria-label="Navigation">
  <div>
    <div class="logo">
      <a href="/"><img src="/images/rook-logo.svg"/></a>
    </div>
    <div
      class="hamburger-controls"
      onclick="if (document.body.classList.contains('menu-open')) { document.body.classList.remove('menu-open') } else { document.body.classList.add('menu-open') }; return false;">
      <span></span> <span></span> <span></span>
    </div>
    <ul class="links">
      <li class="dropdown">
        <a role="button" href="javascript:void(0)">Documentation</a>
        <div class="dropdown-content">
          <a href="/docs/rook/v1.9/">Ceph</a>
          <a href="/docs/cassandra/v1.7/">Cassandra</a>
          <a href="/docs/nfs/v1.7/">NFS</a>
        </div>
      <li class="dropdown">
        <a role="button" href="javascript:void(0)">Community</a>
        <div class="dropdown-content">
          <a href="//github.com/rook/rook">GitHub</a>
          <a href="//slack.rook.io/">Slack</a>
          <a href="//groups.google.com/forum/#!forum/rook-dev">Forum</a>
          <a href="//twitter.com/rook_io">Twitter</a>
        </div>
      </li>
      <li><a href="//blog.rook.io/">Blog</a></li>
      <li><a class="button small" href="/docs/rook/v1.9/quickstart.html">Get Started</a></li>
    </ul>
  </div>
</nav>

    <main id="content" aria-label="Content"><div>



















<section class="docs-header">
  <h1>Ceph</h1>
  <div class="versions">
    <a role="button" href="javascript:void(0)">Rook Ceph v0.7</a>
    <div class="versions-dropdown-content">
      
        <a href="/docs/rook/v1.9/monitoring.html">Rook Ceph v1.9</a>
      
        <a href="/docs/rook/v1.8/monitoring.html">Rook Ceph v1.8</a>
      
        <a href="/docs/rook/v1.7/monitoring.html">Rook Ceph v1.7</a>
      
        <a href="/docs/rook/v1.6/monitoring.html">Rook Ceph v1.6</a>
      
        <a href="/docs/rook/v1.5/monitoring.html">Rook Ceph v1.5</a>
      
        <a href="/docs/rook/v1.4/monitoring.html">Rook Ceph v1.4</a>
      
        <a href="/docs/rook/v1.3/monitoring.html">Rook Ceph v1.3</a>
      
        <a href="/docs/rook/v1.2/monitoring.html">Rook Ceph v1.2</a>
      
        <a href="/docs/rook/v1.1/monitoring.html">Rook Ceph v1.1</a>
      
        <a href="/docs/rook/v1.0/monitoring.html">Rook Ceph v1.0</a>
      
        <a href="/docs/rook/v0.9/monitoring.html">Rook Ceph v0.9</a>
      
        <a href="/docs/rook/v0.8/monitoring.html">Rook Ceph v0.8</a>
      
        <a href="/docs/rook/v0.7/monitoring.html" class="active">Rook Ceph v0.7</a>
      
        <a href="/docs/rook/v0.6/monitoring.html">Rook Ceph v0.6</a>
      
        <a href="/docs/rook/v0.5/monitoring.html">Rook Ceph v0.5</a>
      
        <a href="/docs/rook/latest/monitoring.html">Rook Ceph latest</a>
      
    </div>
    <img src="/images/arrow.svg" />
  </div>
</section>
<div class="page">
  <div class="docs-menu">
      <ul id="docs-ul"></ul>
  </div>
  <div class="docs-content">
    <div class="docs-actions">
      <a id="edit" href="https://github.com/rook/rook/blob/master/Documentation/monitoring.md">Edit on GitHub</a>
    </div>
    
      <div class="alert old">
        <p><b>PLEASE NOTE</b>: This document applies to v0.7 version and not to the latest <strong>stable</strong> release v1.9</p>
      </div>
    
    <div class="docs-text">
      <h1 id="monitoring">Monitoring</h1>

<p>Each Rook cluster has some built in metrics collectors/exporters for monitoring with <a href="https://prometheus.io/">Prometheus</a>.  To enable monitoring of Rook in your Kubernetes cluster, you can follow the steps below.</p>

<p>Note that these steps work only for Kubernetes 1.7.x or higher. For Kubernetes 1.6.x or older, refer to the Rook 0.5.0 <a href="https://github.com/rook/rook/blob/release-0.5/Documentation/monitoring.md">documentation</a> and use these <a href="https://github.com/rook/rook/tree/release-0.5/cluster/examples/kubernetes/monitoring">manifest files</a>.</p>

<h2 id="prometheus-operator">Prometheus Operator</h2>

<p>First the Prometheus operator needs to be started in the cluster so it can watch for our requests to start monitoring Rook and respond by deploying the correct Prometheus pods and configuration.
A full explanation can be found in the <a href="https://github.com/coreos/prometheus-operator">Prometheus operator repository on github</a>, but the quick instructions can be found here:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl apply <span class="nt">-f</span> https://raw.githubusercontent.com/coreos/prometheus-operator/release-0.15/bundle.yaml
</code></pre></div></div>
<p>This will start the Prometheus operator, but before moving on, wait until the operator is in the <code class="language-plaintext highlighter-rouge">Running</code> state:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get pod
</code></pre></div></div>
<p>Once the Prometheus operator is in the <code class="language-plaintext highlighter-rouge">Running</code> state, proceed to the next section.</p>

<h2 id="prometheus-instances">Prometheus Instances</h2>

<p>With the Prometheus operator running, we can create a service monitor that will watch the Rook cluster and collect metrics regularly.
From the root of your locally cloned Rook repo, go the monitoring directory:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>cluster/examples/kubernetes/monitoring
</code></pre></div></div>

<p>Create the service monitor as well as the Prometheus server pod and service:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl create <span class="nt">-f</span> service-monitor.yaml
kubectl create <span class="nt">-f</span> prometheus.yaml
kubectl create <span class="nt">-f</span> prometheus-service.yaml
</code></pre></div></div>

<p>Ensure that the Prometheus server pod gets created and advances to the <code class="language-plaintext highlighter-rouge">Running</code> state before moving on:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl <span class="nt">-n</span> rook get pod prometheus-rook-prometheus-0
</code></pre></div></div>

<h2 id="prometheus-web-console">Prometheus Web Console</h2>

<p>Once the Prometheus server is running, you can open a web browser and go to the URL that is output from this command:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s2">"http://</span><span class="si">$(</span>kubectl <span class="nt">-n</span> rook <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">={</span>.status.hostIP<span class="o">}</span> get pod prometheus-rook-prometheus-0<span class="si">)</span><span class="s2">:30900"</span>
</code></pre></div></div>

<p>You should now see the Prometheus monitoring website.  Click on <code class="language-plaintext highlighter-rouge">Graph</code> in the top navigation bar.  In the dropdown that says <code class="language-plaintext highlighter-rouge">insert metric at cursor</code>,
select any metric you would like to see, for example <code class="language-plaintext highlighter-rouge">ceph_cluster_used_bytes</code>, followed by clicking on the <code class="language-plaintext highlighter-rouge">Execute</code> button.  Below the <code class="language-plaintext highlighter-rouge">Execute</code> button, ensure
the <code class="language-plaintext highlighter-rouge">Graph</code> tab is selected and you should now see a graph of your chosen metric over time.</p>

<h2 id="prometheus-consoles">Prometheus Consoles</h2>
<p>You can find Prometheus Consoles here: https://github.com/ceph/cephmetrics/tree/master/dashboards/current.
A guide to how you can write your own Prometheus consoles can be found on the official Prometheus site here: https://prometheus.io/docs/visualization/consoles/</p>

<h2 id="grafana-dashboards">Grafana Dashboards</h2>
<p>Currently there are no official Rook dashboards, which will change soon, but you can find some here: https://github.com/SUSE/DeepSea/tree/master/srv/salt/ceph/monitoring/grafana/files
To use the dashboards, just download the JSON file(s) and in Grafan import them by uploading the JSON file.</p>

<h2 id="teardown">Teardown</h2>

<p>To clean up all the artifacts created by the monitoring walkthrough, copy/paste the entire block below (note that errors about resources “not found” can be ignored):</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl delete <span class="nt">-f</span> service-monitor.yaml
kubectl delete <span class="nt">-f</span> prometheus.yaml
kubectl delete <span class="nt">-f</span> prometheus-service.yaml
kubectl <span class="nt">-n</span> rook delete statefulset prometheus-rook-prometheus
kubectl delete <span class="nt">-f</span> https://raw.githubusercontent.com/coreos/prometheus-operator/release-0.8/bundle.yaml
</code></pre></div></div>
<p>Then the rest of the instructions in the <a href="https://github.com/coreos/prometheus-operator#removal">Prometheus Operator docs</a> can be followed to finish cleaning up.</p>

<h2 id="special-cases">Special Cases</h2>

<h3 id="tectonic-bare-metal">Tectonic Bare Metal</h3>
<p>Tectonic strongly discourages the <code class="language-plaintext highlighter-rouge">tectonic-system</code> Prometheus instance to be used outside their intentions, so you need to create a new <a href="https://coreos.com/operators/prometheus/docs/latest/">Prometheus Operator</a> yourself.
After this you only need to create the service monitor as stated above.</p>

    </div>
  </div>
</div>

<script>
  var menu = [];
  var BASE_PATH = "";

  function add(name, url, isChild, current) {
    var item = { name: name, url: url, current: current };
    var container = menu;
    if (isChild && menu.length > 0) {
      menu[menu.length-1].children = menu[menu.length-1].children || [];
      container = menu[menu.length-1].children;
      if (current) {
        menu[menu.length-1].childCurrent = true;
      }
    }
    container.push(item);
  }

  
    add(
      "Rook",
      "/docs/rook/v0.7/",
      false,
      false
    );
  
    add(
      "Quickstart",
      "/docs/rook/v0.7/quickstart.html",
      false,
      false
    );
  
    add(
      "Cleanup",
      "/docs/rook/v0.7/teardown.html",
      true,
      false
    );
  
    add(
      "Prerequisites",
      "/docs/rook/v0.7/k8s-pre-reqs.html",
      false,
      false
    );
  
    add(
      "Flex Volume Configuration",
      "/docs/rook/v0.7/flexvolume.html",
      true,
      false
    );
  
    add(
      "RBAC Security",
      "/docs/rook/v0.7/rbac.html",
      true,
      false
    );
  
    add(
      "Tectonic Bare Metal",
      "/docs/rook/v0.7/tectonic.html",
      true,
      false
    );
  
    add(
      "Storage",
      "/docs/rook/v0.7/storage.html",
      false,
      false
    );
  
    add(
      "Block Storage",
      "/docs/rook/v0.7/block.html",
      true,
      false
    );
  
    add(
      "Object Storage",
      "/docs/rook/v0.7/object.html",
      true,
      false
    );
  
    add(
      "Shared File System",
      "/docs/rook/v0.7/filesystem.html",
      true,
      false
    );
  
    add(
      "Custom Resources",
      "/docs/rook/v0.7/crds.html",
      false,
      false
    );
  
    add(
      "Cluster",
      "/docs/rook/v0.7/cluster-crd.html",
      true,
      false
    );
  
    add(
      "Pool",
      "/docs/rook/v0.7/pool-crd.html",
      true,
      false
    );
  
    add(
      "Object Store",
      "/docs/rook/v0.7/object-store-crd.html",
      true,
      false
    );
  
    add(
      "Shared File System",
      "/docs/rook/v0.7/filesystem-crd.html",
      true,
      false
    );
  
    add(
      "Monitoring",
      "/docs/rook/v0.7/monitoring.html",
      false,
      true
    );
  
    add(
      "Helm Charts",
      "/docs/rook/v0.7/helm.html",
      false,
      false
    );
  
    add(
      "Operator",
      "/docs/rook/v0.7/helm-operator.html",
      true,
      false
    );
  
    add(
      "Upgrades",
      "/docs/rook/v0.7/upgrade.html",
      false,
      false
    );
  
    add(
      "Tools",
      "/docs/rook/v0.7/tools.html",
      false,
      false
    );
  
    add(
      "Toolbox",
      "/docs/rook/v0.7/toolbox.html",
      true,
      false
    );
  
    add(
      "Rook Client",
      "/docs/rook/v0.7/client.html",
      true,
      false
    );
  
    add(
      "Advanced Configuration",
      "/docs/rook/v0.7/advanced-configuration.html",
      true,
      false
    );
  
    add(
      "Common Issues",
      "/docs/rook/v0.7/common-problems.html",
      true,
      false
    );
  
    add(
      "Contributing",
      "/docs/rook/v0.7/development-flow.html",
      false,
      false
    );
  
    add(
      "Multi-Node Test Environment",
      "/docs/rook/v0.7/development-environment.html",
      true,
      false
    );
  

  function getEntry(item) {
    var itemDom = document.createElement('li');

    if (item.current) {
      itemDom.innerHTML = item.name;
      itemDom.classList.add('current');
    } else {
      itemDom.innerHTML = '<a href="' + item.url + '">' + item.name + '</a>';
    }

    return itemDom;
  }

  // Flush css changes as explained in: https://stackoverflow.com/a/34726346
  // and more completely: https://stackoverflow.com/a/6956049
  function flushCss(element) {
    element.offsetHeight;
  }

  function addArrow(itemDom) {
    var MAIN_ITEM_HEIGHT = 24;
    var BOTTOM_PADDING = 20;
    var arrowDom = document.createElement('a');
    arrowDom.classList.add('arrow');
    arrowDom.innerHTML = '<img src="' + BASE_PATH + '/images/arrow.svg" />';
    arrowDom.onclick = function(itemDom) {
      return function () {
        // Calculated full height of the opened list
        var fullHeight = MAIN_ITEM_HEIGHT + BOTTOM_PADDING + itemDom.lastChild.clientHeight + 'px';

        itemDom.classList.toggle('open');

        if (itemDom.classList.contains('open')) {
          itemDom.style.height = fullHeight;
        } else {
          // If the list height is auto we have to set it to fullHeight
          // without tranistion before we shrink it to collapsed height
          if (itemDom.style.height === 'auto') {
            itemDom.style.transition = 'none';
            itemDom.style.height = fullHeight;
            flushCss(itemDom);
            itemDom.style.transition = '';
          }
          itemDom.style.height = MAIN_ITEM_HEIGHT + 'px';
        }

        return false;
      };
    }(itemDom);
    itemDom.appendChild(arrowDom);

    if ((item.current && item.children) || item.childCurrent) {
      itemDom.classList.add('open');
      itemDom.style.height = 'auto';
    } else {
      itemDom.style.height = MAIN_ITEM_HEIGHT + 'px';
    }
  }

  var menuDom = document.getElementById('docs-ul');
  for (var i = 0; i < menu.length; i++) {
    var item = menu[i];
    var itemDom = getEntry(item);

    if (item.childCurrent) {
      itemDom.classList.add('childCurrent');
    }

    if (item.children) {
      addArrow(itemDom);
      itemDom.classList.add('children');
      var children = document.createElement('ul');
      for (var j = 0; j < item.children.length; j++) {
        children.appendChild(getEntry(item.children[j]));
      }
      itemDom.appendChild(children);
    }
    menuDom.appendChild(itemDom);
  }
</script>
</div></main>
    <footer id="footer" aria-label="Footer">
  <div class="top">
    <a href="//www.cncf.io">
      <img
        class="cncf"
        src="/images/cncf.png"
        srcset="/images/cncf@2x.png 2x, /images/cncf@3x.png 3x" />
    </a>
    <p>We are a Cloud Native Computing Foundation graduated project.</p>
  </div>
  <div class="middle">
    <div class="grid-center">
      <div class="col_sm-12">
        <span>Getting Started</span>
        <a href="//github.com/rook/rook">GitHub</a>
        <a href="/docs/rook/v1.9/">Documentation</a>
        <a href="//github.com/rook/rook/blob/master/CONTRIBUTING.md#how-to-contribute">How to Contribute</a>
      </div>
      <div class="col_sm-12">
        <span>Community</span>
        <a href="//slack.rook.io/">Slack</a>
        <a href="//twitter.com/rook_io">Twitter</a>
        <a href="//groups.google.com/forum/#!forum/rook-dev">Forum</a>
        <a href="//blog.rook.io/">Blog</a>
      </div>
      <div class="col_sm-12">
        <span>Contact</span>
        <a href="mailto:cncf-rook-info@lists.cncf.io">Email</a>
        <a href="//github.com/rook/rook/issues">Feature request</a>
      </div>
      <div class="col_sm-12">
        <span>Top Contributors</span>
        <a href="//cloudical.io/">Cloudical</a>
        <a href="//cybozu.com">Cybozu, Inc</a>
        <a href="//www.redhat.com">Red Hat</a>
        <a href="//www.suse.com/">SUSE</a>
        <a href="//upbound.io">Upbound</a>
      </div>
    </div>
  </div>
  <div class="bottom">
    <div class="grid-center">
      <div class="col-8">
        <a class="logo" href="/">
          <img src="/images/rook-logo-small.svg" alt="rook.io" />
        </a>
        <p>
          &#169; Rook Authors 2022. Documentation distributed under
          <a href="https://creativecommons.org/licenses/by/4.0">CC-BY-4.0</a>.
        </p>
        <p>
          &#169; 2022 The Linux Foundation. All rights reserved. The Linux Foundation has
          registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our
          <a href="https://www.linuxfoundation.org/trademark-usage/">Trademark Usage</a> page.
        </p>
      </div>
    </div>
  </div>
</footer>


  <script src="/js/anchor.js"></script>
  <script>
    anchors.options = {
      placement: 'right',
      icon: '#',
    }

    document.addEventListener('DOMContentLoaded', function(event) {
      anchors.add('.docs-text h1, .docs-text h2, .docs-text h3, .docs-text h4, .docs-text h5, .docs-text h6');
    });
  </script>




    
  </body>
</html>
