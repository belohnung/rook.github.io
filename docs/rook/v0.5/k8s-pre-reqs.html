












































<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />

    
    <meta name="robots" content="noindex">
    

    <title>Ceph Docs</title>

    <link rel="canonical" href="https://rook.io/docs/rook/v0.5/k8s-pre-reqs.html">

    <link rel="icon" href="/favicon.ico" />
<link rel="icon" type="image/png" href="/images/favicon_16x16.png" sizes="16x16" />
<link rel="icon" type="image/png" href="/images/favicon_32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="/images/favicon_48x48.png" sizes="48x48" />
<link rel="icon" type="image/png" href="/images/favicon_192x192.png" sizes="192x192" />


    <link href="//fonts.googleapis.com/css?family=Montserrat:500|Open+Sans:300,400,600" rel="stylesheet">
    
    <link rel="stylesheet" href="/css/main.css">
    
      <link rel="stylesheet" href="/css/docs.css" />
    
  </head>
  <body>
    <nav id="navigation" aria-label="Navigation">
  <div>
    <div class="logo">
      <a href="/"><img src="/images/rook-logo.svg"/></a>
    </div>
    <div
      class="hamburger-controls"
      onclick="if (document.body.classList.contains('menu-open')) { document.body.classList.remove('menu-open') } else { document.body.classList.add('menu-open') }; return false;">
      <span></span> <span></span> <span></span>
    </div>
    <ul class="links">
      <li class="dropdown">
        <a role="button" href="javascript:void(0)">Documentation</a>
        <div class="dropdown-content">
          <a href="/docs/rook/v1.9/">Ceph</a>
          <a href="/docs/cassandra/v1.7/">Cassandra</a>
          <a href="/docs/nfs/v1.7/">NFS</a>
        </div>
      <li class="dropdown">
        <a role="button" href="javascript:void(0)">Community</a>
        <div class="dropdown-content">
          <a href="//github.com/rook/rook">GitHub</a>
          <a href="//slack.rook.io/">Slack</a>
          <a href="//groups.google.com/forum/#!forum/rook-dev">Forum</a>
          <a href="//twitter.com/rook_io">Twitter</a>
        </div>
      </li>
      <li><a href="//blog.rook.io/">Blog</a></li>
      <li><a class="button small" href="/docs/rook/v1.9/quickstart.html">Get Started</a></li>
    </ul>
  </div>
</nav>

    <main id="content" aria-label="Content"><div>



















<section class="docs-header">
  <h1>Ceph</h1>
  <div class="versions">
    <a role="button" href="javascript:void(0)">Rook Ceph v0.5</a>
    <div class="versions-dropdown-content">
      
        <a href="/docs/rook/v1.9/k8s-pre-reqs.html">Rook Ceph v1.9</a>
      
        <a href="/docs/rook/v1.8/k8s-pre-reqs.html">Rook Ceph v1.8</a>
      
        <a href="/docs/rook/v1.7/k8s-pre-reqs.html">Rook Ceph v1.7</a>
      
        <a href="/docs/rook/v1.6/k8s-pre-reqs.html">Rook Ceph v1.6</a>
      
        <a href="/docs/rook/v1.5/k8s-pre-reqs.html">Rook Ceph v1.5</a>
      
        <a href="/docs/rook/v1.4/k8s-pre-reqs.html">Rook Ceph v1.4</a>
      
        <a href="/docs/rook/v1.3/k8s-pre-reqs.html">Rook Ceph v1.3</a>
      
        <a href="/docs/rook/v1.2/k8s-pre-reqs.html">Rook Ceph v1.2</a>
      
        <a href="/docs/rook/v1.1/k8s-pre-reqs.html">Rook Ceph v1.1</a>
      
        <a href="/docs/rook/v1.0/k8s-pre-reqs.html">Rook Ceph v1.0</a>
      
        <a href="/docs/rook/v0.9/k8s-pre-reqs.html">Rook Ceph v0.9</a>
      
        <a href="/docs/rook/v0.8/k8s-pre-reqs.html">Rook Ceph v0.8</a>
      
        <a href="/docs/rook/v0.7/k8s-pre-reqs.html">Rook Ceph v0.7</a>
      
        <a href="/docs/rook/v0.6/k8s-pre-reqs.html">Rook Ceph v0.6</a>
      
        <a href="/docs/rook/v0.5/k8s-pre-reqs.html" class="active">Rook Ceph v0.5</a>
      
        <a href="/docs/rook/latest/k8s-pre-reqs.html">Rook Ceph latest</a>
      
    </div>
    <img src="/images/arrow.svg" />
  </div>
</section>
<div class="page">
  <div class="docs-menu">
      <ul id="docs-ul"></ul>
  </div>
  <div class="docs-content">
    <div class="docs-actions">
      <a id="edit" href="https://github.com/rook/rook/blob/master/Documentation/k8s-pre-reqs.md">Edit on GitHub</a>
    </div>
    
      <div class="alert old">
        <p><b>PLEASE NOTE</b>: This document applies to v0.5 version and not to the latest <strong>stable</strong> release v1.9</p>
      </div>
    
    <div class="docs-text">
      <h1 id="prerequisites">Prerequisites</h1>

<h2 id="minimum-version">Minimum Version</h2>

<p>Kubernetes v1.6 or higher is targeted by Rook (while Rook is in alpha it will track the latest release to use the latest features).</p>

<p>Support is available for Kubernetes v1.5.2, although your mileage may vary.
You will need to use the yaml files from the <a href="/cluster/examples/kubernetes/1.5">1.5 folder</a>.</p>

<h2 id="privileges">Privileges</h2>

<p>Creating the Rook operator requires privileges for setting up RBAC. To launch the operator you need to have created your user certificate with the <code class="language-plaintext highlighter-rouge">system:masters</code> privilege:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-subj "/CN=admin/O=system:masters"
</code></pre></div></div>

<h2 id="kubeadm">Kubeadm</h2>

<p>You can easily spin up Rook on top of a <code class="language-plaintext highlighter-rouge">kubeadm</code> cluster.
You can find the instructions on how to install kubeadm in the <a href="https://kubernetes.io/docs/getting-started-guides/kubeadm/"><code class="language-plaintext highlighter-rouge">kubeadm</code> installation page</a>.</p>

<p>By using <code class="language-plaintext highlighter-rouge">kubeadm</code>, you can use Rook in just a few minutes!</p>

<p>The only thing you might have to do is to install the <code class="language-plaintext highlighter-rouge">ceph-common</code> package on all nodes that are going to consume Rook PVs.</p>

<h2 id="new-local-kubernetes-cluster-with-vagrant">New local Kubernetes cluster with Vagrant</h2>

<p>For a quick start with a new local cluster, use the Rook fork of <a href="https://github.com/rook/coreos-kubernetes">coreos-kubernetes</a>. This will bring up a multi-node Kubernetes cluster with <code class="language-plaintext highlighter-rouge">vagrant</code> and CoreOS virtual machines ready to use Rook immediately.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/rook/coreos-kubernetes.git
cd coreos-kubernetes/multi-node/vagrant
vagrant up
export KUBECONFIG="$(pwd)/kubeconfig"
kubectl config use-context vagrant-multi
</code></pre></div></div>

<p>Then wait for the cluster to come up and verify that kubernetes is done initializing (be patient, it takes a bit):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl cluster-info
</code></pre></div></div>

<p>Once you see a url response, your cluster is <a href="/docs/rook/v0.5/kubernetes.html#deploy-rook">ready for use by Rook</a>.</p>

<h2 id="minikube">Minikube</h2>

<p>If using <code class="language-plaintext highlighter-rouge">minikube</code>, you can deploy Rook to it with a small update, which modifies the minikube host to install the <code class="language-plaintext highlighter-rouge">rbd</code> command. This is needed by the Kubernetes <code class="language-plaintext highlighter-rouge">rbd</code> volume plugin. To install <code class="language-plaintext highlighter-rouge">minikube</code>, refer to this <a href="https://github.com/kubernetes/minikube/releases">page</a>.</p>

<p>Once you have <code class="language-plaintext highlighter-rouge">minikube</code> installed, start a cluster by doing the following:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>minikube start
<span class="go">Starting local Kubernetes cluster...
Starting VM...
SSH-ing files into VM...
Setting up certs...
Starting cluster components...
Connecting to cluster...
Setting up kubeconfig...
Kubectl is now configured to use the cluster.
</span></code></pre></div></div>

<p>SSH into the minikube host and install <code class="language-plaintext highlighter-rouge">rbd</code>:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>minikube ssh
<span class="gp">$</span><span class="w"> </span><span class="nb">cd</span> /bin
<span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>curl <span class="nt">-O</span> https://raw.githubusercontent.com/ceph/ceph-docker/master/examples/kubernetes-coreos/rbd
<span class="gp">$</span><span class="w"> </span><span class="nb">sudo chmod</span> +x /bin/rbd
<span class="gp">$</span><span class="w"> </span>rbd <span class="c">#run command to download ceph images.</span>
<span class="go">Unable to find image 'ceph/base:latest' locally
latest: Pulling from ceph/base
</span><span class="c">...
</span><span class="gp">$</span><span class="w"> </span><span class="nb">exit</span>
</code></pre></div></div>

<p>After these steps, your minikube cluster is ready to install Rook on.</p>

<h2 id="existing-kubernetes-cluster">Existing Kubernetes Cluster</h2>

<p>Alternatively, if you already have a running Kubernetes cluster, you can deploy Rook to it with a small update to modify the kubelet service to bind mount <code class="language-plaintext highlighter-rouge">/sbin/modprobe</code>, which allows access to <code class="language-plaintext highlighter-rouge">modprobe</code>.
Access to modprobe is necessary for using the rbd volume plugin, which is being tracked in the Kubernetes code base with <a href="https://github.com/kubernetes/kubernetes/issues/23924">#23924</a>.</p>

<p>If using RKT, you can enable <code class="language-plaintext highlighter-rouge">modprobe</code> by following this <a href="https://github.com/coreos/coreos-kubernetes/blob/master/Documentation/kubelet-wrapper.md#allow-pods-to-use-rbd-volumes">guide</a>. Instructions have been directly copied below for your convenience:</p>

<p>Add the following options to the <code class="language-plaintext highlighter-rouge">RKT_OPTS</code> env before launching the kubelet via kubelet-wrapper:</p>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[Service]</span>
<span class="py">Environment</span><span class="p">=</span><span class="s">KUBELET_VERSION=v1.5.3_coreos.0</span>
<span class="py">Environment</span><span class="p">=</span><span class="s">"RKT_OPTS=--volume modprobe,kind=host,source=/usr/sbin/modprobe </span><span class="se">\
</span><span class="s">  --mount volume=modprobe,target=/usr/sbin/modprobe </span><span class="se">\
</span><span class="s">  --volume lib-modules,kind=host,source=/lib/modules </span><span class="se">\
</span><span class="s">  --mount volume=lib-modules,target=/lib/modules </span><span class="se">\
</span><span class="s">  --uuid-file-save=/var/run/kubelet-pod.uuid"</span>
<span class="err">...</span>
</code></pre></div></div>

<p>Note that the kubelet also requires access to the userspace <code class="language-plaintext highlighter-rouge">rbd</code> tool that is included only in hyperkube images tagged <code class="language-plaintext highlighter-rouge">v1.3.6_coreos.0</code> or later. See next section on how to deploy <code class="language-plaintext highlighter-rouge">rbd</code>.</p>

<h2 id="ceph-and-rbd-utilities-installed-on-the-nodes">Ceph and RBD utilities installed on the nodes</h2>

<p>The Kubernetes kubelet shells out to system utilities to mount Rook volumes. This means that every Kubernetes host must have these utilities installed. This requirement extends to the control plane, since there may be interactions between kube-controller-manager and the Ceph cluster. Login to each Kubernetes host where Kubelet runs and execute the following:</p>

<p>For Debian-based distros:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt-get install ceph-fs-common ceph-common
</code></pre></div></div>

<p>For Redhat-based distros:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum install ceph
</code></pre></div></div>

<p>For other Linux distros that don’t have an explicit package manager, such as CoreOS, you can use a container with the ceph utilities. To deploy the containers on your hosts, do the following:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /bin
sudo curl -O https://raw.githubusercontent.com/ceph/ceph-docker/master/examples/kubernetes-coreos/rbd
sudo chmod +x /bin/rbd
rbd #Command to download ceph images.
</code></pre></div></div>

<h2 id="using-rook-in-kubernetes">Using Rook in Kubernetes</h2>

<p>Now that you have a Kubernetes cluster running, you can start using Rook with <a href="/docs/rook/v0.5/kubernetes.html#deploy-rook">these steps</a>.</p>

    </div>
  </div>
</div>

<script>
  var menu = [];
  var BASE_PATH = "";

  function add(name, url, isChild, current) {
    var item = { name: name, url: url, current: current };
    var container = menu;
    if (isChild && menu.length > 0) {
      menu[menu.length-1].children = menu[menu.length-1].children || [];
      container = menu[menu.length-1].children;
      if (current) {
        menu[menu.length-1].childCurrent = true;
      }
    }
    container.push(item);
  }

  
    add(
      "Rook",
      "/docs/rook/v0.5/",
      false,
      false
    );
  
    add(
      "Kubernetes",
      "/docs/rook/v0.5/kubernetes.html",
      false,
      false
    );
  
    add(
      "Prerequisites",
      "/docs/rook/v0.5/k8s-pre-reqs.html",
      true,
      true
    );
  
    add(
      "Block Storage",
      "/docs/rook/v0.5/k8s-block.html",
      true,
      false
    );
  
    add(
      "Object Storage",
      "/docs/rook/v0.5/k8s-object.html",
      true,
      false
    );
  
    add(
      "Shared File System",
      "/docs/rook/v0.5/k8s-filesystem.html",
      true,
      false
    );
  
    add(
      "Monitoring",
      "/docs/rook/v0.5/k8s-monitoring.html",
      true,
      false
    );
  
    add(
      "Pool CRD",
      "/docs/rook/v0.5/pool-crd.html",
      true,
      false
    );
  
    add(
      "Cluster CRD",
      "/docs/rook/v0.5/cluster-crd.html",
      true,
      false
    );
  
    add(
      "Helm Chart",
      "/docs/rook/v0.5/helm-operator.html",
      true,
      false
    );
  
    add(
      "Standalone",
      "/docs/rook/v0.5/standalone.html",
      false,
      false
    );
  
    add(
      "Rook Client",
      "/docs/rook/v0.5/client.html",
      false,
      false
    );
  
    add(
      "Contributing",
      "/docs/rook/v0.5/development-flow.html",
      false,
      false
    );
  
    add(
      "Toolbox",
      "/docs/rook/v0.5/toolbox.html",
      false,
      false
    );
  
    add(
      "Advanced Configuration",
      "/docs/rook/v0.5/advanced-configuration.html",
      true,
      false
    );
  

  function getEntry(item) {
    var itemDom = document.createElement('li');

    if (item.current) {
      itemDom.innerHTML = item.name;
      itemDom.classList.add('current');
    } else {
      itemDom.innerHTML = '<a href="' + item.url + '">' + item.name + '</a>';
    }

    return itemDom;
  }

  // Flush css changes as explained in: https://stackoverflow.com/a/34726346
  // and more completely: https://stackoverflow.com/a/6956049
  function flushCss(element) {
    element.offsetHeight;
  }

  function addArrow(itemDom) {
    var MAIN_ITEM_HEIGHT = 24;
    var BOTTOM_PADDING = 20;
    var arrowDom = document.createElement('a');
    arrowDom.classList.add('arrow');
    arrowDom.innerHTML = '<img src="' + BASE_PATH + '/images/arrow.svg" />';
    arrowDom.onclick = function(itemDom) {
      return function () {
        // Calculated full height of the opened list
        var fullHeight = MAIN_ITEM_HEIGHT + BOTTOM_PADDING + itemDom.lastChild.clientHeight + 'px';

        itemDom.classList.toggle('open');

        if (itemDom.classList.contains('open')) {
          itemDom.style.height = fullHeight;
        } else {
          // If the list height is auto we have to set it to fullHeight
          // without tranistion before we shrink it to collapsed height
          if (itemDom.style.height === 'auto') {
            itemDom.style.transition = 'none';
            itemDom.style.height = fullHeight;
            flushCss(itemDom);
            itemDom.style.transition = '';
          }
          itemDom.style.height = MAIN_ITEM_HEIGHT + 'px';
        }

        return false;
      };
    }(itemDom);
    itemDom.appendChild(arrowDom);

    if ((item.current && item.children) || item.childCurrent) {
      itemDom.classList.add('open');
      itemDom.style.height = 'auto';
    } else {
      itemDom.style.height = MAIN_ITEM_HEIGHT + 'px';
    }
  }

  var menuDom = document.getElementById('docs-ul');
  for (var i = 0; i < menu.length; i++) {
    var item = menu[i];
    var itemDom = getEntry(item);

    if (item.childCurrent) {
      itemDom.classList.add('childCurrent');
    }

    if (item.children) {
      addArrow(itemDom);
      itemDom.classList.add('children');
      var children = document.createElement('ul');
      for (var j = 0; j < item.children.length; j++) {
        children.appendChild(getEntry(item.children[j]));
      }
      itemDom.appendChild(children);
    }
    menuDom.appendChild(itemDom);
  }
</script>
</div></main>
    <footer id="footer" aria-label="Footer">
  <div class="top">
    <a href="//www.cncf.io">
      <img
        class="cncf"
        src="/images/cncf.png"
        srcset="/images/cncf@2x.png 2x, /images/cncf@3x.png 3x" />
    </a>
    <p>We are a Cloud Native Computing Foundation graduated project.</p>
  </div>
  <div class="middle">
    <div class="grid-center">
      <div class="col_sm-12">
        <span>Getting Started</span>
        <a href="//github.com/rook/rook">GitHub</a>
        <a href="/docs/rook/v1.9/">Documentation</a>
        <a href="//github.com/rook/rook/blob/master/CONTRIBUTING.md#how-to-contribute">How to Contribute</a>
      </div>
      <div class="col_sm-12">
        <span>Community</span>
        <a href="//slack.rook.io/">Slack</a>
        <a href="//twitter.com/rook_io">Twitter</a>
        <a href="//groups.google.com/forum/#!forum/rook-dev">Forum</a>
        <a href="//blog.rook.io/">Blog</a>
      </div>
      <div class="col_sm-12">
        <span>Contact</span>
        <a href="mailto:cncf-rook-info@lists.cncf.io">Email</a>
        <a href="//github.com/rook/rook/issues">Feature request</a>
      </div>
      <div class="col_sm-12">
        <span>Top Contributors</span>
        <a href="//cloudical.io/">Cloudical</a>
        <a href="//cybozu.com">Cybozu, Inc</a>
        <a href="//www.redhat.com">Red Hat</a>
        <a href="//www.suse.com/">SUSE</a>
        <a href="//upbound.io">Upbound</a>
      </div>
    </div>
  </div>
  <div class="bottom">
    <div class="grid-center">
      <div class="col-8">
        <a class="logo" href="/">
          <img src="/images/rook-logo-small.svg" alt="rook.io" />
        </a>
        <p>
          &#169; Rook Authors 2022. Documentation distributed under
          <a href="https://creativecommons.org/licenses/by/4.0">CC-BY-4.0</a>.
        </p>
        <p>
          &#169; 2022 The Linux Foundation. All rights reserved. The Linux Foundation has
          registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our
          <a href="https://www.linuxfoundation.org/trademark-usage/">Trademark Usage</a> page.
        </p>
      </div>
    </div>
  </div>
</footer>


  <script src="/js/anchor.js"></script>
  <script>
    anchors.options = {
      placement: 'right',
      icon: '#',
    }

    document.addEventListener('DOMContentLoaded', function(event) {
      anchors.add('.docs-text h1, .docs-text h2, .docs-text h3, .docs-text h4, .docs-text h5, .docs-text h6');
    });
  </script>




    
  </body>
</html>
