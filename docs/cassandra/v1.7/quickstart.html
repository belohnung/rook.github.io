












































<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />

    

    <title>Cassandra Docs</title>

    <link rel="canonical" href="https://rook.io/docs/cassandra/v1.7/quickstart.html">

    <link rel="icon" href="/favicon.ico" />
<link rel="icon" type="image/png" href="/images/favicon_16x16.png" sizes="16x16" />
<link rel="icon" type="image/png" href="/images/favicon_32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="/images/favicon_48x48.png" sizes="48x48" />
<link rel="icon" type="image/png" href="/images/favicon_192x192.png" sizes="192x192" />


    <link href="//fonts.googleapis.com/css?family=Montserrat:500|Open+Sans:300,400,600" rel="stylesheet">
    
    <link rel="stylesheet" href="/css/main.css">
    
      <link rel="stylesheet" href="/css/docs.css" />
    
  </head>
  <body>
    <nav id="navigation" aria-label="Navigation">
  <div>
    <div class="logo">
      <a href="/"><img src="/images/rook-logo.svg"/></a>
    </div>
    <div
      class="hamburger-controls"
      onclick="if (document.body.classList.contains('menu-open')) { document.body.classList.remove('menu-open') } else { document.body.classList.add('menu-open') }; return false;">
      <span></span> <span></span> <span></span>
    </div>
    <ul class="links">
      <li class="dropdown">
        <a role="button" href="javascript:void(0)">Documentation</a>
        <div class="dropdown-content">
          <a href="/docs/rook/v1.9/">Ceph</a>
          <a href="/docs/cassandra/v1.7/">Cassandra</a>
          <a href="/docs/nfs/v1.7/">NFS</a>
        </div>
      <li class="dropdown">
        <a role="button" href="javascript:void(0)">Community</a>
        <div class="dropdown-content">
          <a href="//github.com/rook/rook">GitHub</a>
          <a href="//slack.rook.io/">Slack</a>
          <a href="//groups.google.com/forum/#!forum/rook-dev">Forum</a>
          <a href="//twitter.com/rook_io">Twitter</a>
        </div>
      </li>
      <li><a href="//blog.rook.io/">Blog</a></li>
      <li><a class="button small" href="/docs/rook/v1.9/quickstart.html">Get Started</a></li>
    </ul>
  </div>
</nav>

    <main id="content" aria-label="Content"><div>



















<section class="docs-header">
  <h1>Cassandra</h1>
  <div class="versions">
    <a role="button" href="javascript:void(0)">Rook Cassandra v1.7</a>
    <div class="versions-dropdown-content">
      
        <a href="/docs/cassandra/v1.7/quickstart.html" class="active">Rook Cassandra v1.7</a>
      
        <a href="/docs/cassandra/latest/quickstart.html">Rook Cassandra latest</a>
      
    </div>
    <img src="/images/arrow.svg" />
  </div>
</section>
<div class="page">
  <div class="docs-menu">
      <ul id="docs-ul"></ul>
  </div>
  <div class="docs-content">
    <div class="docs-actions">
      <a id="edit" href="https://github.com/rook/cassandra/blob/master/Documentation/quickstart.md">Edit on GitHub</a>
    </div>
    
    <div class="docs-text">
      
<h1 id="cassandra-quickstart">Cassandra Quickstart</h1>

<p><strong>The Rook Cassandra operator is <a href="https://github.com/rook/cassandra#deprecated">deprecated</a></strong></p>

<p>Welcome to Rook! We hope you have a great experience installing the Rook <strong>cloud-native storage orchestrator</strong> platform to enable highly available, durable storage in your Kubernetes cluster.</p>

<p><a href="http://cassandra.apache.org/">Cassandra</a> is a highly available, fault tolerant, peer-to-peer NoSQL database featuring lightning fast performance and tunable consistency. It provides massive scalability with no single point of failure.</p>

<p><a href="https://www.scylladb.com">Scylla</a> is a close-to-the-hardware rewrite of Cassandra in C++. It features a shared nothing architecture that enables true linear scaling and major hardware optimizations that achieve ultra-low latencies and extreme throughput. It is a drop-in replacement for Cassandra and uses the same interfaces, so it is also supported by Rook.</p>

<p>If you have any questions along the way, please don’t hesitate to ask us in our <a href="https://rook-io.slack.com">Slack channel</a>. You can sign up for our Slack <a href="https://slack.rook.io">here</a>.</p>

<h2 id="deploy-cassandra-operator">Deploy Cassandra Operator</h2>

<p>First deploy the Rook Cassandra Operator using the following commands:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>git clone <span class="nt">--single-branch</span> <span class="nt">--branch</span> v1.7.3 https://github.com/rook/cassandra.git
<span class="go">cd rook/cluster/examples/kubernetes/cassandra
kubectl apply -f crds.yaml
kubectl apply -f operator.yaml
</span></code></pre></div></div>

<p>This will install the operator in namespace rook-cassandra-system. You can check if the operator is up and running with:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl -n rook-cassandra-system get pod
</span></code></pre></div></div>

<h2 id="create-and-initialize-a-cassandrascylla-cluster">Create and Initialize a Cassandra/Scylla Cluster</h2>

<p>Now that the operator is running, we can create an instance of a Cassandra/Scylla cluster by creating an instance of the <code class="language-plaintext highlighter-rouge">clusters.cassandra.rook.io</code> resource.
Some of that resource’s values are configurable, so feel free to browse <code class="language-plaintext highlighter-rouge">cluster.yaml</code> and tweak the settings to your liking.
Full details for all the configuration options can be found in the <a href="/docs/cassandra/v1.7/cassandra-cluster-crd.html">Cassandra Cluster CRD documentation</a>.</p>

<p>When you are ready to create a Cassandra cluster, simply run:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl create -f cluster.yaml
</span></code></pre></div></div>

<p>We can verify that a Kubernetes object has been created that represents our new Cassandra cluster with the command below.
This is important because it shows that Rook has successfully extended Kubernetes to make Cassandra clusters a first class citizen in the Kubernetes cloud-native environment.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl -n rook-cassandra get clusters.cassandra.rook.io
</span></code></pre></div></div>

<p>To check if all the desired members are running, you should see the same number of entries from the following command as the number of members that was specified in <code class="language-plaintext highlighter-rouge">cluster.yaml</code>:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl -n rook-cassandra get pod -l app=rook-cassandra
</span></code></pre></div></div>

<p>You can also track the state of a Cassandra cluster from its status. To check the current status of a Cluster, run:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl -n rook-cassandra describe clusters.cassandra.rook.io rook-cassandra
</span></code></pre></div></div>

<h2 id="accessing-the-database">Accessing the Database</h2>

<ul>
  <li>From kubectl:</li>
</ul>

<p>To get a <code class="language-plaintext highlighter-rouge">cqlsh</code> shell in your new Cluster:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl exec -n rook-cassandra -it rook-cassandra-east-1-east-1a-0 -- cqlsh
</span><span class="gp">&gt;</span><span class="w"> </span>DESCRIBE KEYSPACES<span class="p">;</span>
</code></pre></div></div>

<ul>
  <li>From inside a Pod:</li>
</ul>

<p>When you create a new Cluster, Rook automatically creates a Service for the clients to use in order to access the Cluster. The service’s name follows the convention <code class="language-plaintext highlighter-rouge">&lt;cluster-name&gt;-client</code>. You can see this Service in you cluster by running:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl -n rook-cassandra describe service rook-cassandra-client
</span></code></pre></div></div>

<p>Pods running inside the Kubernetes cluster can use this Service to connect to Cassandra.
Here’s an example using the <a href="https://github.com/datastax/python-driver">Python Driver</a>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">cassandra.cluster</span> <span class="kn">import</span> <span class="n">Cluster</span>

<span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">([</span><span class="s">'rook-cassandra-client.rook-cassandra.svc.cluster.local'</span><span class="p">])</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">cluster</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="scale-up">Scale Up</h2>

<p>The operator supports scale up of a rack as well as addition of new racks. To make the changes, you can use:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl edit clusters.cassandra.rook.io rook-cassandra
</span></code></pre></div></div>

<ul>
  <li>To scale up a rack, change the <code class="language-plaintext highlighter-rouge">Spec.Members</code> field of the rack to the desired value.</li>
  <li>To add a new rack, append the <code class="language-plaintext highlighter-rouge">racks</code> list with a new rack. Remember to choose a different rack name for the new rack.</li>
  <li>After editing and saving the yaml, check your cluster’s Status and Events for information on what’s happening:</li>
</ul>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl -n rook-cassandra describe clusters.cassandra.rook.io rook-cassandra
</span></code></pre></div></div>

<h2 id="scale-down">Scale Down</h2>

<p>The operator supports scale down of a rack. To make the changes, you can use:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl edit clusters.cassandra.rook.io rook-cassandra
</span></code></pre></div></div>

<ul>
  <li>To scale down a rack, change the <code class="language-plaintext highlighter-rouge">Spec.Members</code> field of the rack to the desired value.</li>
  <li>After editing and saving the yaml, check your cluster’s Status and Events for information on what’s happening:</li>
</ul>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl -n rook-cassandra describe clusters.cassandra.rook.io rook-cassandra
</span></code></pre></div></div>

<h2 id="clean-up">Clean Up</h2>

<p>To clean up all resources associated with this walk-through, you can run the commands below.</p>

<blockquote>
  <p><strong>NOTE</strong>: that this will destroy your database and delete all of its associated data.</p>
</blockquote>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl delete -f cluster.yaml
kubectl delete -f operator.yaml
kubectl delete -f crds.yaml
</span></code></pre></div></div>

<h2 id="troubleshooting">Troubleshooting</h2>

<p>If the cluster does not come up, the first step would be to examine the operator’s logs:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl -n rook-cassandra-system logs -l app=rook-cassandra-operator
</span></code></pre></div></div>

<p>If everything looks OK in the operator logs, you can also look in the logs for one of the Cassandra instances:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl -n rook-cassandra logs rook-cassandra-0
</span></code></pre></div></div>

<h2 id="cassandra-monitoring">Cassandra Monitoring</h2>

<p>To enable jmx_exporter for cassandra rack, you should specify <code class="language-plaintext highlighter-rouge">jmxExporterConfigMapName</code> option for rack in CassandraCluster CRD.</p>

<p>For example:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">cassandra.rook.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Cluster</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">my-cassandra</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-cassandra</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="s">...</span>
  <span class="s">datacenter</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">my-datacenter</span>
    <span class="na">racks</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">my-rack</span>
      <span class="na">members</span><span class="pi">:</span> <span class="m">3</span>
      <span class="na">jmxExporterConfigMapName</span><span class="pi">:</span> <span class="s">jmx-exporter-settings</span>
      <span class="na">storage</span><span class="pi">:</span>
        <span class="na">volumeClaimTemplates</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">metadata</span><span class="pi">:</span>
            <span class="na">name</span><span class="pi">:</span> <span class="s">rook-cassandra-data</span>
          <span class="na">spec</span><span class="pi">:</span>
            <span class="na">storageClassName</span><span class="pi">:</span> <span class="s">my-storage-class</span>
            <span class="na">resources</span><span class="pi">:</span>
              <span class="na">requests</span><span class="pi">:</span>
                <span class="na">storage</span><span class="pi">:</span> <span class="s">200Gi</span>
</code></pre></div></div>

<p>Simple config map example to get all metrics:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">jmx-exporter-settings</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-cassandra</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="s">jmx_exporter_config.yaml</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">lowercaseOutputLabelNames: true</span>
    <span class="s">lowercaseOutputName: true</span>
    <span class="s">whitelistObjectNames: ["org.apache.cassandra.metrics:*"]</span>
</code></pre></div></div>

<p>ConfigMap’s data field must contain <code class="language-plaintext highlighter-rouge">jmx_exporter_config.yaml</code> key with jmx exporter settings.</p>

<p>There is no automatic reloading mechanism for pods when the config map updated.
After the configmap changed, you should restart all rack pods manually:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">NAMESPACE</span><span class="o">=</span>&lt;namespace&gt;
<span class="nv">CLUSTER</span><span class="o">=</span>&lt;cluster_name&gt;
<span class="nv">RACKS</span><span class="o">=</span><span class="si">$(</span>kubectl get sts <span class="nt">-n</span> <span class="k">${</span><span class="nv">NAMESPACE</span><span class="k">}</span> <span class="nt">-l</span> <span class="s2">"cassandra.rook.io/cluster=</span><span class="k">${</span><span class="nv">CLUSTER</span><span class="k">}</span><span class="s2">"</span><span class="si">)</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">RACKS</span><span class="k">}</span> | xargs <span class="nt">-n1</span> kubectl rollout restart <span class="nt">-n</span> <span class="k">${</span><span class="nv">NAMESPACE</span><span class="k">}</span>
</code></pre></div></div>

    </div>
  </div>
</div>

<script>
  var menu = [];
  var BASE_PATH = "";

  function add(name, url, isChild, current) {
    var item = { name: name, url: url, current: current };
    var container = menu;
    if (isChild && menu.length > 0) {
      menu[menu.length-1].children = menu[menu.length-1].children || [];
      container = menu[menu.length-1].children;
      if (current) {
        menu[menu.length-1].childCurrent = true;
      }
    }
    container.push(item);
  }

  
    add(
      "Rook",
      "/docs/cassandra/v1.7/",
      false,
      false
    );
  
    add(
      "Prerequisites",
      "/docs/cassandra/v1.7/k8s-pre-reqs.html",
      false,
      false
    );
  
    add(
      "Cassandra Quickstart",
      "/docs/cassandra/v1.7/quickstart.html",
      false,
      true
    );
  
    add(
      "Cassandra Cluster CRD",
      "/docs/cassandra/v1.7/cassandra-cluster-crd.html",
      false,
      false
    );
  
    add(
      "Cassandra Upgrade",
      "/docs/cassandra/v1.7/cassandra-operator-upgrade.html",
      false,
      false
    );
  
    add(
      "Common Issues",
      "/docs/cassandra/v1.7/common-issues.html",
      false,
      false
    );
  
    add(
      "Contributing",
      "/docs/cassandra/v1.7/development-flow.html",
      false,
      false
    );
  

  function getEntry(item) {
    var itemDom = document.createElement('li');

    if (item.current) {
      itemDom.innerHTML = item.name;
      itemDom.classList.add('current');
    } else {
      itemDom.innerHTML = '<a href="' + item.url + '">' + item.name + '</a>';
    }

    return itemDom;
  }

  // Flush css changes as explained in: https://stackoverflow.com/a/34726346
  // and more completely: https://stackoverflow.com/a/6956049
  function flushCss(element) {
    element.offsetHeight;
  }

  function addArrow(itemDom) {
    var MAIN_ITEM_HEIGHT = 24;
    var BOTTOM_PADDING = 20;
    var arrowDom = document.createElement('a');
    arrowDom.classList.add('arrow');
    arrowDom.innerHTML = '<img src="' + BASE_PATH + '/images/arrow.svg" />';
    arrowDom.onclick = function(itemDom) {
      return function () {
        // Calculated full height of the opened list
        var fullHeight = MAIN_ITEM_HEIGHT + BOTTOM_PADDING + itemDom.lastChild.clientHeight + 'px';

        itemDom.classList.toggle('open');

        if (itemDom.classList.contains('open')) {
          itemDom.style.height = fullHeight;
        } else {
          // If the list height is auto we have to set it to fullHeight
          // without tranistion before we shrink it to collapsed height
          if (itemDom.style.height === 'auto') {
            itemDom.style.transition = 'none';
            itemDom.style.height = fullHeight;
            flushCss(itemDom);
            itemDom.style.transition = '';
          }
          itemDom.style.height = MAIN_ITEM_HEIGHT + 'px';
        }

        return false;
      };
    }(itemDom);
    itemDom.appendChild(arrowDom);

    if ((item.current && item.children) || item.childCurrent) {
      itemDom.classList.add('open');
      itemDom.style.height = 'auto';
    } else {
      itemDom.style.height = MAIN_ITEM_HEIGHT + 'px';
    }
  }

  var menuDom = document.getElementById('docs-ul');
  for (var i = 0; i < menu.length; i++) {
    var item = menu[i];
    var itemDom = getEntry(item);

    if (item.childCurrent) {
      itemDom.classList.add('childCurrent');
    }

    if (item.children) {
      addArrow(itemDom);
      itemDom.classList.add('children');
      var children = document.createElement('ul');
      for (var j = 0; j < item.children.length; j++) {
        children.appendChild(getEntry(item.children[j]));
      }
      itemDom.appendChild(children);
    }
    menuDom.appendChild(itemDom);
  }
</script>
</div></main>
    <footer id="footer" aria-label="Footer">
  <div class="top">
    <a href="//www.cncf.io">
      <img
        class="cncf"
        src="/images/cncf.png"
        srcset="/images/cncf@2x.png 2x, /images/cncf@3x.png 3x" />
    </a>
    <p>We are a Cloud Native Computing Foundation graduated project.</p>
  </div>
  <div class="middle">
    <div class="grid-center">
      <div class="col_sm-12">
        <span>Getting Started</span>
        <a href="//github.com/rook/rook">GitHub</a>
        <a href="/docs/rook/v1.9/">Documentation</a>
        <a href="//github.com/rook/rook/blob/master/CONTRIBUTING.md#how-to-contribute">How to Contribute</a>
      </div>
      <div class="col_sm-12">
        <span>Community</span>
        <a href="//slack.rook.io/">Slack</a>
        <a href="//twitter.com/rook_io">Twitter</a>
        <a href="//groups.google.com/forum/#!forum/rook-dev">Forum</a>
        <a href="//blog.rook.io/">Blog</a>
      </div>
      <div class="col_sm-12">
        <span>Contact</span>
        <a href="mailto:cncf-rook-info@lists.cncf.io">Email</a>
        <a href="//github.com/rook/rook/issues">Feature request</a>
      </div>
      <div class="col_sm-12">
        <span>Top Contributors</span>
        <a href="//cloudical.io/">Cloudical</a>
        <a href="//cybozu.com">Cybozu, Inc</a>
        <a href="//www.redhat.com">Red Hat</a>
        <a href="//www.suse.com/">SUSE</a>
        <a href="//upbound.io">Upbound</a>
      </div>
    </div>
  </div>
  <div class="bottom">
    <div class="grid-center">
      <div class="col-8">
        <a class="logo" href="/">
          <img src="/images/rook-logo-small.svg" alt="rook.io" />
        </a>
        <p>
          &#169; Rook Authors 2022. Documentation distributed under
          <a href="https://creativecommons.org/licenses/by/4.0">CC-BY-4.0</a>.
        </p>
        <p>
          &#169; 2022 The Linux Foundation. All rights reserved. The Linux Foundation has
          registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our
          <a href="https://www.linuxfoundation.org/trademark-usage/">Trademark Usage</a> page.
        </p>
      </div>
    </div>
  </div>
</footer>


  <script src="/js/anchor.js"></script>
  <script>
    anchors.options = {
      placement: 'right',
      icon: '#',
    }

    document.addEventListener('DOMContentLoaded', function(event) {
      anchors.add('.docs-text h1, .docs-text h2, .docs-text h3, .docs-text h4, .docs-text h5, .docs-text h6');
    });
  </script>




    
  </body>
</html>
